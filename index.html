<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smart Attendance System - Panchayati Raj Department</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --secondary: #00695c;
            --accent: #ff6f00;
            --success: #2e7d32;
            --danger: #c62828;
            --warning: #f57c00;
            --info: #0277bd;
            --light: #f5f5f5;
            --dark: #212121;
            --gray: #757575;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Loading Screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Login Page */
        #loginPage {
            width: 100%;
            max-width: 450px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: block;
        }

        .login-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .login-header .logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .login-header .logo i {
            font-size: 40px;
            color: var(--primary);
        }

        .login-header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .login-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .login-type-selector {
            padding: 20px 30px 0;
            text-align: center;
        }

        .login-type-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .login-type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .login-form {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .demo-credentials {
            background: #f0f7ff;
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 25px;
            border-left: 4px solid var(--primary);
        }

        .demo-credentials h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 16px;
        }

        .demo-credentials p {
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--dark);
        }

        /* Main App Containers */
        #mainApp, #employeeApp {
            display: none;
            width: 100%;
            height: 100vh;
            background: #f5f7fa;
            position: fixed;
            top: 0;
            left: 0;
        }

        /* Header */
        .app-header {
            background: white;
            padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-section .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .logo-text h2 {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 3px;
        }

        .logo-text p {
            font-size: 12px;
            color: var(--gray);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            background: #f5f7fa;
            border-radius: 25px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .user-details h4 {
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .user-details span {
            font-size: 12px;
            color: var(--gray);
        }

        .logout-btn {
            background: #ffeaea;
            color: var(--danger);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            height: calc(100vh - 70px);
            margin-top: 70px;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 25px 0;
            overflow-y: auto;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0 20px;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            color: var(--dark);
            text-decoration: none;
            border-radius: var(--radius);
            transition: all 0.3s;
            font-weight: 500;
            font-size: 15px;
        }

        .nav-link:hover {
            background: #f0f7ff;
            color: var(--primary);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-link i {
            font-size: 18px;
            width: 24px;
        }

        .sidebar-stats {
            margin: 30px 20px 0;
            padding: 20px;
            background: #f5f7fa;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-item:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f5f7fa;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Section */
        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-header h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .dashboard-header p {
            color: var(--gray);
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: white;
        }

        .stat-card:nth-child(1) .stat-icon { background: linear-gradient(135deg, var(--success) 0%, #4caf50 100%); }
        .stat-card:nth-child(2) .stat-icon { background: linear-gradient(135deg, var(--danger) 0%, #ef5350 100%); }
        .stat-card:nth-child(3) .stat-icon { background: linear-gradient(135deg, var(--info) 0%, #29b6f6 100%); }
        .stat-card:nth-child(4) .stat-icon { background: linear-gradient(135deg, var(--warning) 0%, #ff9800 100%); }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quick-actions {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        .quick-actions h2 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 22px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .action-card {
            background: #f8f9ff;
            border: 2px solid #e8eaf6;
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .action-card i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .action-card h3 {
            color: var(--dark);
            font-size: 16px;
            margin-bottom: 8px;
        }

        .action-card p {
            color: var(--gray);
            font-size: 13px;
        }

        /* Attendance Section */
        .attendance-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            color: var(--primary);
            font-size: 24px;
        }

        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .camera-section {
            background: #f8f9ff;
            border-radius: var(--radius);
            padding: 25px;
            border: 2px dashed #c5cae9;
        }

        .camera-preview {
            width: 100%;
            height: 300px;
            background: #e8eaf6;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .camera-preview i {
            font-size: 60px;
            color: var(--primary);
        }

        .camera-controls {
            display: flex;
            gap: 15px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #4caf50 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #ff9800 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #ef5350 100%);
            color: white;
        }

        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-size: 16px;
            background: white;
        }

        .location-info {
            background: #f0f7ff;
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 20px;
        }

        .location-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .location-row:last-child {
            border-bottom: none;
        }

        /* Map Container */
        .map-container {
            width: 100%;
            height: 300px;
            border-radius: var(--radius);
            margin-top: 20px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }

        .geofence-map {
            width: 100%;
            height: 100%;
        }

        .geofence-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: var(--radius);
            margin-top: 15px;
            font-weight: 600;
        }

        .geofence-status.inside {
            background: #e8f5e9;
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .geofence-status.outside {
            background: #ffebee;
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        .geofence-status i {
            font-size: 20px;
        }

        /* Records Section */
        .records-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }

        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid #e0e0e0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .data-table th {
            background: #f5f7fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid #e0e0e0;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            color: var(--dark);
        }

        .data-table tr:hover {
            background: #f8f9ff;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-present {
            background: #e8f5e9;
            color: var(--success);
        }

        .status-absent {
            background: #ffebee;
            color: var(--danger);
        }

        .status-pending {
            background: #fff3e0;
            color: var(--warning);
        }

        .status-approved {
            background: #e8f5e9;
            color: var(--success);
        }

        .status-rejected {
            background: #ffebee;
            color: var(--danger);
        }

        /* Employees Section */
        .employees-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .table-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Employee Geofence Info */
        .employee-geofence-info {
            background: #f0f7ff;
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 10px;
            border-left: 3px solid var(--primary);
        }

        .employee-geofence-info p {
            margin: 5px 0;
            font-size: 14px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            color: var(--primary);
            font-size: 22px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #f5f5f5;
            color: var(--danger);
        }

        /* Employee Geofence Settings */
        .employee-geofence-settings {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: var(--radius);
            border: 2px solid #e8eaf6;
        }

        .geofence-settings h4 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .geofence-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .geofence-controls input {
            flex: 1;
        }

        /* Leave Application Form */
        .leave-form-container {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 600px;
            margin: 0 auto;
        }

        .leave-summary {
            background: #f8f9ff;
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
        }

        .leave-summary h4 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .leave-summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .leave-summary-item:last-child {
            border-bottom: none;
        }

        .leave-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }

        .calendar-day {
            padding: 10px;
            text-align: center;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-day:hover {
            background: #f0f0f0;
        }

        .calendar-day.selected {
            background: var(--primary);
            color: white;
        }

        /* Employee Dashboard */
        .employee-dashboard {
            padding: 30px;
        }

        .employee-welcome {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .employee-welcome h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .employee-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .employee-stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .employee-stat-card i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .employee-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .employee-action-card {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
        }

        .employee-action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .employee-action-card i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .employee-action-card h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .employee-action-card p {
            color: var(--gray);
            font-size: 14px;
        }

        /* New Features Styling */
        
        /* Analytics Charts */
        .chart-container {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .chart-container h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Training Section */
        .training-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .training-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--info);
        }

        .training-card h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
        }

        /* Biometric Section */
        .biometric-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .biometric-option {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .biometric-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .biometric-option i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        /* Notification Center */
        .notifications-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .notification-item {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--info);
            box-shadow: var(--shadow);
        }

        .notification-item.unread {
            border-left-color: var(--primary);
            background: #f0f7ff;
        }

        /* Holiday Calendar */
        .holiday-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .holiday-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        /* Mobile App QR */
        .qr-container {
            text-align: center;
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
        }

        /* AI Analytics Dashboard */
        .ai-insights {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
        }

        .ai-insights h3 {
            margin-bottom: 20px;
            font-size: 22px;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Payroll Integration */
        .payroll-summary {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        /* Performance Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .two-column-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .sidebar {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                padding: 15px 0;
            }
            
            .sidebar-nav {
                display: flex;
                overflow-x: auto;
                padding: 0 15px;
                gap: 10px;
            }
            
            .nav-item {
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .nav-link {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .sidebar-stats {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .actions-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .app-header {
                padding: 0 15px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .geofence-controls {
                flex-direction: column;
            }
            
            .table-actions {
                flex-direction: column;
                align-items: center;
            }

            .employee-actions {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .user-section {
                gap: 10px;
            }
            
            .user-info .user-details {
                display: none;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--radius);
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 3000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success) 0%, #4caf50 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #ef5350 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--info) 0%, #29b6f6 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #ff9800 100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
        }

        .tab {
            padding: 12px 25px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Leave Status Colors */
        .leave-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .leave-pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .leave-approved {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .leave-rejected {
            background: #ffebee;
            color: #c62828;
        }

        /* Password Change */
        .password-change-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        /* Training Progress */
        .progress-container {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loader"></div>
        <div style="color: white; text-align: center; margin-top: 20px;">
            <h3 style="margin-bottom: 10px;">AI Smart Attendance System</h3>
            <p>Panchayati Raj Department, Bihar</p>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage">
        <div class="login-header">
            <div class="logo">
                <i class="fas fa-landmark"></i>
            </div>
            <h1>AI Smart Attendance</h1>
            <p>Panchayati Raj Department, Bihar Government</p>
        </div>
        
        <div class="login-type-selector">
            <div class="login-type-buttons">
                <button type="button" class="login-type-btn active" id="adminLoginBtn">
                    <i class="fas fa-user-shield"></i> Admin Login
                </button>
                <button type="button" class="login-type-btn" id="employeeLoginBtn">
                    <i class="fas fa-user"></i> Employee Login
                </button>
            </div>
        </div>
        
        <div class="login-form">
            <form id="loginForm">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> User ID</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter your user ID" required>
                </div>
                
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <a href="#" id="forgotPasswordLink" style="color: var(--primary); font-size: 14px; text-decoration: none;">
                        <i class="fas fa-key"></i> Forgot Password?
                    </a>
                </div>
                
                <input type="hidden" id="loginType" value="admin">
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="demo-credentials" id="demoCredentials">
                    <h4><i class="fas fa-info-circle"></i> Contact Aman for Admin ID & Password:</h4>
                    <p><strong></strong> </p>
                    <p><strong></strong> </p>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ccc;">
                        <h4>Demo Employee Credentials:</h4>
                        <p><strong>User ID:</strong> E001</p>
                        <p><strong>Password:</strong> E001</p>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Admin Application -->
    <div id="mainApp">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-landmark"></i>
                </div>
                <div class="logo-text">
                    <h2>AI Smart Attendance</h2>
                    <p>Panchayati Raj Department, Sheikhpura</p>
                </div>
            </div>
            
            <div class="user-section">
                <div class="notification-bell" style="position: relative; cursor: pointer;">
                    <i class="fas fa-bell" style="font-size: 20px; color: var(--primary);" id="notificationBell"></i>
                    <span class="badge" style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; display: none;" id="notificationCount">0</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="user-details">
                        <h4 id="currentUserName">Administrator</h4>
                        <span id="currentUserRole">System Admin</span>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Sidebar -->
            <nav class="sidebar">
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#attendance" class="nav-link" data-section="attendance">
                            <i class="fas fa-camera"></i>
                            <span>Mark Attendance</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#records" class="nav-link" data-section="records">
                            <i class="fas fa-history"></i>
                            <span>Attendance Records</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#employees" class="nav-link" data-section="employees">
                            <i class="fas fa-users"></i>
                            <span>Employee Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#leaves" class="nav-link" data-section="leaves">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Leave Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#geofence" class="nav-link" data-section="geofence">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Geofence Settings</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#reports" class="nav-link" data-section="reports">
                            <i class="fas fa-chart-bar"></i>
                            <span>Reports & Analytics</span>
                        </a>
                    </li>
                    <!-- New Features -->
                    <li class="nav-item">
                        <a href="#analytics" class="nav-link" data-section="analytics">
                            <i class="fas fa-brain"></i>
                            <span>AI Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#training" class="nav-link" data-section="training">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Training</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#biometric" class="nav-link" data-section="biometric">
                            <i class="fas fa-fingerprint"></i>
                            <span>Biometric</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#notifications" class="nav-link" data-section="notifications">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#settings" class="nav-link" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
                
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <span class="stat-label">Today's Attendance</span>
                        <span class="stat-value" id="sidebarAttendanceCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Employees</span>
                        <span class="stat-value" id="sidebarEmployeeCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Present Today</span>
                        <span class="stat-value" id="sidebarPresentCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Pending Leaves</span>
                        <span class="stat-value" id="sidebarPendingLeaves">0</span>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Section -->
                <section id="dashboardSection" class="content-section active">
                    <div class="dashboard-header">
                        <h1>Welcome, Administrator</h1>
                        <p>AI-powered Smart Attendance Management System</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-value" id="todayPresent">0</div>
                            <div class="stat-label">Present Today</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-times"></i>
                            </div>
                            <div class="stat-value" id="todayAbsent">0</div>
                            <div class="stat-label">Absent Today</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="totalEmployeesDash">0</div>
                            <div class="stat-label">Total Employees</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-value" id="pendingLeavesDash">0</div>
                            <div class="stat-label">Pending Leaves</div>
                        </div>
                    </div>
                    
                    <!-- AI Insights -->
                    <div class="ai-insights">
                        <h3><i class="fas fa-brain"></i> AI Insights</h3>
                        <div class="insight-item">
                            <i class="fas fa-chart-line"></i>
                            <span>Attendance trend is improving by 15% this month</span>
                        </div>
                        <div class="insight-item">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>3 employees have low attendance rate (below 70%)</span>
                        </div>
                        <div class="insight-item">
                            <i class="fas fa-lightbulb"></i>
                            <span>Predicted optimal office timing: 9:15 AM - 5:30 PM</span>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <h2>Quick Actions</h2>
                        <div class="actions-grid">
                            <div class="action-card" id="quickMarkAttendance">
                                <i class="fas fa-camera"></i>
                                <h3>Mark Attendance</h3>
                                <p>Mark attendance for employees</p>
                            </div>
                            
                            <div class="action-card" id="quickViewRecords">
                                <i class="fas fa-history"></i>
                                <h3>View Today's Records</h3>
                                <p>Check today's attendance</p>
                            </div>
                            
                            <div class="action-card" id="quickAddEmployee">
                                <i class="fas fa-user-plus"></i>
                                <h3>Add Employee</h3>
                                <p>Register new employee</p>
                            </div>
                            
                            <div class="action-card" id="quickManageLeaves">
                                <i class="fas fa-calendar-check"></i>
                                <h3>Manage Leaves</h3>
                                <p>Approve/reject leave requests</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Metrics -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="avgAttendance">85%</div>
                            <div class="stat-label">Avg Attendance</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="lateComers">2</div>
                            <div class="stat-label">Late Comers Today</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="earlyLeavers">1</div>
                            <div class="stat-label">Early Leavers</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="overtimeHours">12</div>
                            <div class="stat-label">Overtime Hours</div>
                        </div>
                    </div>
                </section>

                <!-- Attendance Section -->
                <section id="attendanceSection" class="content-section">
                    <div class="attendance-container">
                        <div class="section-header">
                            <h2><i class="fas fa-camera"></i> Mark Attendance</h2>
                            <div class="current-time" id="currentTime"></div>
                        </div>
                        
                        <div class="two-column-layout">
                            <div class="form-section">
                                <div class="form-group">
                                    <label for="attendanceEmployee">Select Employee</label>
                                    <select id="attendanceEmployee" class="form-control">
                                        <option value="">-- Select Employee --</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="attendanceDepartment">Department</label>
                                    <input type="text" id="attendanceDepartment" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="attendanceDesignation">Designation</label>
                                    <input type="text" id="attendanceDesignation" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="attendanceOffice">Office Name</label>
                                    <input type="text" id="attendanceOffice" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="attendanceRemarks">Remarks (Optional)</label>
                                    <textarea id="attendanceRemarks" class="form-control" rows="3" placeholder="Enter any remarks"></textarea>
                                </div>
                                
                                <div class="location-info">
                                    <h4><i class="fas fa-map-marker-alt"></i> Location Information</h4>
                                    <div class="location-row">
                                        <span>Coordinates:</span>
                                        <span id="locationCoordinates">Fetching...</span>
                                    </div>
                                    <div class="location-row">
                                        <span>IP Address:</span>
                                        <span id="ipAddress">Fetching...</span>
                                    </div>
                                    <div class="location-row">
                                        <span>Photo Time:</span>
                                        <span id="photoCaptureTime">Not captured</span>
                                    </div>
                                    <div class="location-row">
                                        <span>Geofence Status:</span>
                                        <span id="geofenceStatusText">Checking...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="camera-section">
                                <h3><i class="fas fa-camera"></i> Camera Preview</h3>
                                <div class="camera-preview" id="cameraPreview">
                                    <i class="fas fa-camera"></i>
                                </div>
                                
                                <div class="camera-controls">
                                    <button class="btn btn-success" id="startCameraBtn">
                                        <i class="fas fa-video"></i> Start Camera
                                    </button>
                                    <button class="btn btn-warning" id="capturePhotoBtn" disabled>
                                        <i class="fas fa-camera-retro"></i> Capture
                                    </button>
                                    <button class="btn btn-danger" id="stopCameraBtn" disabled>
                                        <i class="fas fa-stop"></i> Stop
                                    </button>
                                </div>
                                
                                <div style="margin-top: 20px; display: flex; gap: 10px;">
                                    <button class="btn btn-primary" id="markAttendanceBtn" disabled style="flex: 1;">
                                        <i class="fas fa-check-circle"></i> Mark Attendance
                                    </button>
                                    <button class="btn btn-info" id="markManualBtn" style="flex: 1;">
                                        <i class="fas fa-user-edit"></i> Manual Entry
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Records Section -->
                <section id="recordsSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-history"></i> Attendance Records</h2>
                            <div class="filter-bar">
                                <input type="date" id="filterDate" class="form-control" style="width: 200px;">
                                <select id="filterEmployee" class="form-control" style="width: 200px;">
                                    <option value="">All Employees</option>
                                </select>
                                <select id="filterStatus" class="form-control" style="width: 200px;">
                                    <option value="">All Status</option>
                                    <option value="present">Present</option>
                                    <option value="absent">Absent</option>
                                    <option value="late">Late</option>
                                    <option value="half-day">Half Day</option>
                                </select>
                                <button class="btn btn-primary" id="applyFilterBtn">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                                <button class="btn" id="resetFilterBtn">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>S.No</th>
                                        <th>Employee</th>
                                        <th>Department</th>
                                        <th>Office Name</th>
                                        <th>Time</th>
                                        <th>Status</th>
                                        <th>Location</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recordsTableBody">
                                    <!-- Records will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button class="btn btn-primary" id="exportRecordsBtn">
                                <i class="fas fa-file-export"></i> Export CSV
                            </button>
                            <button class="btn btn-success" id="exportPDFBtn">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Employees Section -->
                <section id="employeesSection" class="content-section">
                    <div class="employees-container">
                        <div class="section-header">
                            <h2><i class="fas fa-users"></i> Employee Management</h2>
                            <div style="display: flex; gap: 15px;">
                                <button class="btn btn-primary" id="addEmployeeBtn">
                                    <i class="fas fa-user-plus"></i> Add Employee
                                </button>
                                <button class="btn btn-success" id="importEmployeesBtn">
                                    <i class="fas fa-file-import"></i> Import CSV
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Office Name</th>
                                        <th>Designation</th>
                                        <th>Login ID</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="employeesTableBody">
                                    <!-- Employees will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="employee-geofence-info">
                            <p><i class="fas fa-info-circle"></i> Total Employees: <span id="totalEmployeesCount">0</span> | Active: <span id="activeEmployeesCount">0</span> | Inactive: <span id="inactiveEmployeesCount">0</span></p>
                        </div>
                    </div>
                </section>

                <!-- Leave Management Section -->
                <section id="leavesSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-calendar-alt"></i> Leave Management</h2>
                        </div>
                        
                        <div class="tabs">
                            <button class="tab active" data-tab="pending">Pending Leaves</button>
                            <button class="tab" data-tab="approved">Approved Leaves</button>
                            <button class="tab" data-tab="rejected">Rejected Leaves</button>
                            <button class="tab" data-tab="all">All Leaves</button>
                        </div>
                        
                        <!-- Pending Leaves Tab -->
                        <div id="pendingTab" class="tab-content active">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>Employee</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Applied On</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pendingLeavesTableBody">
                                        <!-- Pending leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Approved Leaves Tab -->
                        <div id="approvedTab" class="tab-content">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>Employee</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Approved By</th>
                                            <th>Approved On</th>
                                        </tr>
                                    </thead>
                                    <tbody id="approvedLeavesTableBody">
                                        <!-- Approved leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Rejected Leaves Tab -->
                        <div id="rejectedTab" class="tab-content">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>Employee</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Rejected By</th>
                                            <th>Rejected On</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rejectedLeavesTableBody">
                                        <!-- Rejected leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- All Leaves Tab -->
                        <div id="allTab" class="tab-content">
                            <div class="filter-bar" style="margin-bottom: 20px;">
                                <input type="date" id="filterLeaveDate" class="form-control" style="width: 200px;">
                                <select id="filterLeaveEmployee" class="form-control" style="width: 200px;">
                                    <option value="">All Employees</option>
                                </select>
                                <select id="filterLeaveStatus" class="form-control" style="width: 200px;">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                                <button class="btn btn-primary" id="applyLeaveFilterBtn">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                            
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>S.No</th>
                                            <th>Employee</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Status</th>
                                            <th>Applied On</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allLeavesTableBody">
                                        <!-- All leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Geofence Settings Section -->
                <section id="geofenceSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-map-marker-alt"></i> Geofence Settings</h2>
                        </div>
                        
                        <div class="employee-geofence-settings">
                            <h4><i class="fas fa-globe"></i> Global Geofence Settings</h4>
                            <p style="color: var(--gray); font-size: 14px; margin-bottom: 15px;">
                                Set the allowed area where employees can mark attendance
                            </p>
                            
                            <div class="geofence-controls">
                                <input type="number" id="geofenceLat" class="form-control" placeholder="Latitude (e.g., 25.5941)" step="any" value="25.5941">
                                <input type="number" id="geofenceLng" class="form-control" placeholder="Longitude (e.g., 85.1376)" step="any" value="85.1376">
                                <input type="number" id="geofenceRadius" class="form-control" placeholder="Radius (meters)" value="100" min="10" max="1000">
                            </div>
                            
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-success" id="useCurrentLocationBtn">
                                    <i class="fas fa-location-arrow"></i> Use Current Location
                                </button>
                                <button class="btn btn-primary" id="saveGeofenceBtn">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                            </div>
                            
                            <div class="map-container" style="margin-top: 20px;">
                                <div id="geofenceMap" class="geofence-map"></div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <h4><i class="fas fa-users"></i> Employee-wise Geofence</h4>
                                <select id="employeeGeofenceSelect" class="form-control" style="margin-top: 10px;">
                                    <option value="">Select Employee to Set Individual Geofence</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reportsSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
                        </div>
                        
                        <div class="stats-grid" style="margin-bottom: 40px;">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <h3>Daily Report</h3>
                                <p>Today's detailed attendance report</p>
                                <button class="btn btn-primary" id="generateDailyReport">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <h3>Monthly Report</h3>
                                <p>Monthly attendance summary</p>
                                <button class="btn btn-primary" id="generateMonthlyReport">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <h3>Department Report</h3>
                                <p>Department-wise analysis</p>
                                <button class="btn btn-primary" id="generateDeptReport">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <h3>Leave Report</h3>
                                <p>Leave utilization report</p>
                                <button class="btn btn-primary" id="generateLeaveReport">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                        
                        <!-- Charts -->
                        <div class="two-column-layout" style="margin-top: 30px;">
                            <div class="chart-container">
                                <h3><i class="fas fa-chart-line"></i> Attendance Trend</h3>
                                <canvas id="attendanceTrendChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3><i class="fas fa-chart-pie"></i> Department Distribution</h3>
                                <canvas id="departmentChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NEW: AI Analytics Section -->
                <section id="analyticsSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-brain"></i> AI Analytics & Insights</h2>
                        </div>
                        
                        <div class="ai-insights" style="margin-bottom: 30px;">
                            <h3><i class="fas fa-lightbulb"></i> Predictive Insights</h3>
                            <div class="insight-item">
                                <i class="fas fa-chart-line"></i>
                                <span>Next month attendance prediction: 92%  3%</span>
                            </div>
                            <div class="insight-item">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>High absenteeism predicted on Fridays</span>
                            </div>
                            <div class="insight-item">
                                <i class="fas fa-users"></i>
                                <span>Team efficiency can improve by 18% with shift optimization</span>
                            </div>
                        </div>
                        
                        <div class="two-column-layout">
                            <div class="chart-container">
                                <h3><i class="fas fa-chart-bar"></i> Employee Performance</h3>
                                <canvas id="performanceChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3><i class="fas fa-chart-area"></i> Attendance Heatmap</h3>
                                <canvas id="heatmapChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-container" style="margin-top: 30px;">
                            <h3><i class="fas fa-tachometer-alt"></i> Productivity Analytics</h3>
                            <canvas id="productivityChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- NEW: Training Section -->
                <section id="trainingSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-graduation-cap"></i> Employee Training & Development</h2>
                            <button class="btn btn-primary" id="addTrainingBtn">
                                <i class="fas fa-plus"></i> Add Training
                            </button>
                        </div>
                        
                        <div class="training-cards">
                            <div class="training-card">
                                <h4><i class="fas fa-laptop-code"></i> System Training</h4>
                                <p>Complete guide to using AI Attendance System</p>
                                <div class="progress-container">
                                    <span>Completion: 85%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 85%;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;">
                                    <i class="fas fa-play"></i> Start Training
                                </button>
                            </div>
                            
                            <div class="training-card">
                                <h4><i class="fas fa-shield-alt"></i> Security Protocols</h4>
                                <p>Data security and privacy training</p>
                                <div class="progress-container">
                                    <span>Completion: 60%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;">
                                    <i class="fas fa-play"></i> Start Training
                                </button>
                            </div>
                            
                            <div class="training-card">
                                <h4><i class="fas fa-chart-line"></i> Advanced Analytics</h4>
                                <p>Understanding reports and analytics</p>
                                <div class="progress-container">
                                    <span>Completion: 45%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 45%;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;">
                                    <i class="fas fa-play"></i> Start Training
                                </button>
                            </div>
                        </div>
                        
                        <div class="chart-container" style="margin-top: 30px;">
                            <h3><i class="fas fa-chart-bar"></i> Training Progress Overview</h3>
                            <canvas id="trainingProgressChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- NEW: Biometric Section -->
                <section id="biometricSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-fingerprint"></i> Biometric Integration</h2>
                        </div>
                        
                        <div class="biometric-options">
                            <div class="biometric-option" id="fingerprintOption">
                                <i class="fas fa-fingerprint"></i>
                                <h4>Fingerprint</h4>
                                <p>Setup fingerprint authentication</p>
                                <span class="status-badge status-pending" style="margin-top: 10px;">Setup Required</span>
                            </div>
                            
                            <div class="biometric-option" id="faceRecognitionOption">
                                <i class="fas fa-user-check"></i>
                                <h4>Face Recognition</h4>
                                <p>Enable AI face recognition</p>
                                <span class="status-badge status-present" style="margin-top: 10px;">Active</span>
                            </div>
                            
                            <div class="biometric-option" id="voiceRecognitionOption">
                                <i class="fas fa-microphone"></i>
                                <h4>Voice Recognition</h4>
                                <p>Setup voice-based authentication</p>
                                <span class="status-badge status-pending" style="margin-top: 10px;">Coming Soon</span>
                            </div>
                            
                            <div class="biometric-option" id="irisScannerOption">
                                <i class="fas fa-eye"></i>
                                <h4>Iris Scanner</h4>
                                <p>Setup iris recognition system</p>
                                <span class="status-badge status-absent" style="margin-top: 10px;">Not Available</span>
                            </div>
                        </div>
                        
                        <div class="employee-geofence-settings" style="margin-top: 30px;">
                            <h4><i class="fas fa-cogs"></i> Biometric Settings</h4>
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableBiometric" checked>
                                    <span>Enable Biometric Authentication</span>
                                </label>
                            </div>
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableMultiFactor" checked>
                                    <span>Enable Multi-factor Authentication</span>
                                </label>
                            </div>
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableFallback" checked>
                                    <span>Enable Password Fallback</span>
                                </label>
                            </div>
                            <button class="btn btn-primary" id="saveBiometricSettings">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>
                    </div>
                </section>

                <!-- NEW: Notifications Section -->
                <section id="notificationsSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-bell"></i> Notification Center</h2>
                            <button class="btn" id="markAllReadBtn">
                                <i class="fas fa-check-double"></i> Mark All Read
                            </button>
                        </div>
                        
                        <div class="tabs">
                            <button class="tab active" data-tab="allNotifications">All</button>
                            <button class="tab" data-tab="unreadNotifications">Unread</button>
                            <button class="tab" data-tab="systemNotifications">System</button>
                            <button class="tab" data-tab="alertNotifications">Alerts</button>
                        </div>
                        
                        <div id="allNotificationsTab" class="tab-content active">
                            <div class="notifications-list" id="notificationsList">
                                <!-- Notifications will be loaded here -->
                            </div>
                        </div>
                        
                        <div id="unreadNotificationsTab" class="tab-content">
                            <div class="notifications-list" id="unreadNotificationsList">
                                <!-- Unread notifications will be loaded here -->
                            </div>
                        </div>
                        
                        <div id="systemNotificationsTab" class="tab-content">
                            <div class="notifications-list" id="systemNotificationsList">
                                <!-- System notifications will be loaded here -->
                            </div>
                        </div>
                        
                        <div id="alertNotificationsTab" class="tab-content">
                            <div class="notifications-list" id="alertNotificationsList">
                                <!-- Alert notifications will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settingsSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-cog"></i> System Settings</h2>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-group">
                                <label>System Language</label>
                                <select class="form-control" id="systemLanguage">
                                    <option value="hi">Hindi</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Attendance Start Time</label>
                                <input type="time" class="form-control" id="startTime" value="09:00">
                            </div>
                            
                            <div class="form-group">
                                <label>Attendance End Time</label>
                                <input type="time" class="form-control" id="endTime" value="17:00">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableGeofence" checked>
                                    <span>Enable Geofence Restriction</span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableNotifications" checked>
                                    <span>Enable Push Notifications</span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableCamera" checked>
                                    <span>Enable Camera Feature</span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 30px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="enableGPS" checked>
                                    <span>Enable Location Tracking</span>
                                </label>
                            </div>
                            
                            <!-- NEW: Data Management -->
                            <div class="employee-geofence-settings" style="margin-bottom: 30px;">
                                <h4><i class="fas fa-database"></i> Data Management</h4>
                                <div style="display: flex; gap: 15px; margin-top: 15px;">
                                    <button class="btn btn-info" id="backupDataBtn">
                                        <i class="fas fa-download"></i> Backup Data
                                    </button>
                                    <button class="btn btn-warning" id="restoreDataBtn">
                                        <i class="fas fa-upload"></i> Restore Data
                                    </button>
                                    <button class="btn btn-danger" id="clearDataBtn">
                                        <i class="fas fa-trash"></i> Clear All Data
                                    </button>
                                </div>
                            </div>
                            
                            <!-- NEW: Mobile App Section -->
                            <div class="qr-container">
                                <h4><i class="fas fa-mobile-alt"></i> Mobile App Access</h4>
                                <p>Scan QR code to download mobile app</p>
                                <div class="qr-code">
                                    <i class="fas fa-qrcode" style="font-size: 80px; color: var(--primary);"></i>
                                </div>
                                <p style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                    Available on iOS and Android
                                </p>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 30px;">
                                <button class="btn btn-primary" id="saveSettingsBtn">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                                <button class="btn" id="resetSettingsBtn">
                                    <i class="fas fa-redo"></i> Reset to Default
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Employee Application -->
    <div id="employeeApp">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-landmark"></i>
                </div>
                <div class="logo-text">
                    <h2>AI Smart Attendance</h2>
                    <p>Panchayati Raj Department, Sheikhpura</p>
                </div>
            </div>
            
            <div class="user-section">
                <div class="notification-bell" style="position: relative; cursor: pointer;">
                    <i class="fas fa-bell" style="font-size: 20px; color: var(--primary);" id="empNotificationBell"></i>
                    <span class="badge" style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; display: none;" id="empNotificationCount">0</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h4 id="employeeUserName">Employee</h4>
                        <span id="employeeUserRole">Employee</span>
                    </div>
                </div>
                <button class="logout-btn" id="employeeLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Sidebar -->
            <nav class="sidebar">
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a href="#empDashboard" class="nav-link active" data-section="empDashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#empAttendance" class="nav-link" data-section="empAttendance">
                            <i class="fas fa-camera"></i>
                            <span>Mark Attendance</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#empLeave" class="nav-link" data-section="empLeave">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Apply Leave</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#empHistory" class="nav-link" data-section="empHistory">
                            <i class="fas fa-history"></i>
                            <span>My Attendance</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#empLeaveStatus" class="nav-link" data-section="empLeaveStatus">
                            <i class="fas fa-calendar-check"></i>
                            <span>Leave Status</span>
                        </a>
                    </li>
                    <!-- NEW: Employee Features -->
                    <li class="nav-item">
                        <a href="#empTraining" class="nav-link" data-section="empTraining">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Training</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#empProfile" class="nav-link" data-section="empProfile">
                            <i class="fas fa-user-cog"></i>
                            <span>My Profile</span>
                        </a>
                    </li>
                </ul>
                
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <span class="stat-label">Today's Status</span>
                        <span class="stat-value" id="empTodayStatus">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">This Month</span>
                        <span class="stat-value" id="empMonthPresent">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Leaves Taken</span>
                        <span class="stat-value" id="empLeavesTaken">0</span>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Employee Dashboard Section -->
                <section id="empDashboardSection" class="content-section active">
                    <div class="employee-dashboard">
                        <div class="employee-welcome">
                            <h1 id="empWelcomeMessage">Welcome, Employee</h1>
                            <p id="empWelcomeDetails">Panchayati Raj Department, Sheikhpura</p>
                            <div id="empCurrentTime" style="font-size: 18px; margin-top: 10px; color: var(--primary);"></div>
                        </div>
                        
                        <div class="employee-stats">
                            <div class="employee-stat-card">
                                <i class="fas fa-calendar-check"></i>
                                <div class="stat-value" id="empTotalPresent">0</div>
                                <div class="stat-label">Present This Month</div>
                            </div>
                            
                            <div class="employee-stat-card">
                                <i class="fas fa-calendar-times"></i>
                                <div class="stat-value" id="empTotalAbsent">0</div>
                                <div class="stat-label">Absent This Month</div>
                            </div>
                            
                            <div class="employee-stat-card">
                                <i class="fas fa-calendar-alt"></i>
                                <div class="stat-value" id="empTotalLeaves">0</div>
                                <div class="stat-label">Leaves This Month</div>
                            </div>
                            
                            <div class="employee-stat-card">
                                <i class="fas fa-percentage"></i>
                                <div class="stat-value" id="empAttendancePercentage">0%</div>
                                <div class="stat-label">Attendance %</div>
                            </div>
                        </div>
                        
                        <!-- Employee AI Insights -->
                        <div class="ai-insights" style="margin-bottom: 30px;">
                            <h3><i class="fas fa-lightbulb"></i> Your Performance Insights</h3>
                            <div class="insight-item">
                                <i class="fas fa-trophy"></i>
                                <span>Your attendance is better than 85% of colleagues</span>
                            </div>
                            <div class="insight-item">
                                <i class="fas fa-clock"></i>
                                <span>Average arrival time: 9:15 AM (On time!)</span>
                            </div>
                            <div class="insight-item">
                                <i class="fas fa-calendar"></i>
                                <span>Next recommended leave: Last week of next month</span>
                            </div>
                        </div>
                        
                        <div class="employee-actions">
                            <div class="employee-action-card" id="empQuickAttendance">
                                <i class="fas fa-camera"></i>
                                <h3>Mark Today's Attendance</h3>
                                <p>Click here to mark your attendance for today using camera and location</p>
                            </div>
                            
                            <div class="employee-action-card" id="empQuickLeave">
                                <i class="fas fa-calendar-plus"></i>
                                <h3>Apply for Leave</h3>
                                <p>Apply for casual, sick, or earned leave with approval system</p>
                            </div>
                            
                            <div class="employee-action-card" id="empQuickHistory">
                                <i class="fas fa-history"></i>
                                <h3>View Attendance History</h3>
                                <p>Check your attendance records and history for any date</p>
                            </div>
                            
                            <div class="employee-action-card" id="empQuickTraining">
                                <i class="fas fa-graduation-cap"></i>
                                <h3>Access Training</h3>
                                <p>Complete training modules and improve your skills</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Employee Attendance Section -->
                <section id="empAttendanceSection" class="content-section">
                    <div class="attendance-container">
                        <div class="section-header">
                            <h2><i class="fas fa-camera"></i> Mark Your Attendance</h2>
                            <div class="current-time" id="empCurrentTime2"></div>
                        </div>
                        
                        <div id="empAlreadyMarked" style="display: none; background: #e8f5e9; padding: 20px; border-radius: var(--radius); margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-check-circle" style="font-size: 40px; color: var(--success); margin-bottom: 10px;"></i>
                            <h3 style="color: var(--success);">Attendance Already Marked</h3>
                            <p id="empMarkedDetails">Your attendance has been marked for today.</p>
                        </div>
                        
                        <div class="two-column-layout">
                            <div class="form-section">
                                <div class="form-group">
                                    <label>Employee Name</label>
                                    <input type="text" id="empAttendanceName" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Department</label>
                                    <input type="text" id="empAttendanceDepartment" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Designation</label>
                                    <input type="text" id="empAttendanceDesignation" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Office Name</label>
                                    <input type="text" id="empAttendanceOffice" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label for="empAttendanceRemarks">Remarks (Optional)</label>
                                    <textarea id="empAttendanceRemarks" class="form-control" rows="3" placeholder="Enter any remarks"></textarea>
                                </div>
                                
                                <div class="location-info">
                                    <h4><i class="fas fa-map-marker-alt"></i> Location Information</h4>
                                    <div class="location-row">
                                        <span>Coordinates:</span>
                                        <span id="empLocationCoordinates">Fetching...</span>
                                    </div>
                                    <div class="location-row">
                                        <span>IP Address:</span>
                                        <span id="empIpAddress">Fetching...</span>
                                    </div>
                                    <div class="location-row">
                                        <span>Photo Time:</span>
                                        <span id="empPhotoCaptureTime">Not captured</span>
                                    </div>
                                    <div class="location-row">
                                        <span>Geofence Status:</span>
                                        <span id="empGeofenceStatusText">Checking...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="camera-section">
                                <h3><i class="fas fa-camera"></i> Camera Preview</h3>
                                <div class="camera-preview" id="empCameraPreview">
                                    <i class="fas fa-camera"></i>
                                </div>
                                
                                <div class="camera-controls">
                                    <button class="btn btn-success" id="empStartCameraBtn">
                                        <i class="fas fa-video"></i> Start Camera
                                    </button>
                                    <button class="btn btn-warning" id="empCapturePhotoBtn" disabled>
                                        <i class="fas fa-camera-retro"></i> Capture
                                    </button>
                                    <button class="btn btn-danger" id="empStopCameraBtn" disabled>
                                        <i class="fas fa-stop"></i> Stop
                                    </button>
                                </div>
                                
                                <!-- NEW: Biometric Options -->
                                <div style="margin-top: 15px; padding: 15px; background: #f8f9ff; border-radius: var(--radius); border: 2px dashed #c5cae9;">
                                    <h4 style="color: var(--primary); font-size: 14px; margin-bottom: 10px;">
                                        <i class="fas fa-fingerprint"></i> Alternative Methods
                                    </h4>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn btn-info" id="useBiometricBtn" style="flex: 1;">
                                            <i class="fas fa-fingerprint"></i> Use Biometric
                                        </button>
                                        <button class="btn" id="useManualBtn" style="flex: 1;">
                                            <i class="fas fa-keyboard"></i> Manual Entry
                                        </button>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <button class="btn btn-primary" id="empMarkAttendanceBtn" disabled style="width: 100%;">
                                        <i class="fas fa-check-circle"></i> Mark My Attendance
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Employee Leave Application Section -->
                <section id="empLeaveSection" class="content-section">
                    <div class="leave-form-container">
                        <div class="section-header">
                            <h2><i class="fas fa-calendar-plus"></i> Apply for Leave</h2>
                        </div>
                        
                        <div class="leave-summary">
                            <h4><i class="fas fa-info-circle"></i> Leave Balance</h4>
                            <div class="leave-summary-item">
                                <span>Casual Leave:</span>
                                <span><strong id="empCasualLeaveBalance">12</strong> days remaining</span>
                            </div>
                            <div class="leave-summary-item">
                                <span>Sick Leave:</span>
                                <span><strong id="empSickLeaveBalance">15</strong> days remaining</span>
                            </div>
                            <div class="leave-summary-item">
                                <span>Earned Leave:</span>
                                <span><strong id="empEarnedLeaveBalance">30</strong> days remaining</span>
                            </div>
                        </div>
                        
                        <form id="empLeaveForm">
                            <div class="form-group">
                                <label for="empLeaveType">Leave Type</label>
                                <select id="empLeaveType" class="form-control" required>
                                    <option value="">Select Leave Type</option>
                                    <option value="casual">Casual Leave (CL)</option>
                                    <option value="sick">Sick Leave (SL)</option>
                                    <option value="earned">Earned Leave (EL)</option>
                                    <option value="optional">Optional Holiday</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="empLeaveFromDate">From Date</label>
                                <input type="date" id="empLeaveFromDate" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="empLeaveToDate">To Date</label>
                                <input type="date" id="empLeaveToDate" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Number of Days</label>
                                <input type="text" id="empLeaveDays" class="form-control" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label for="empLeaveReason">Reason for Leave</label>
                                <textarea id="empLeaveReason" class="form-control" rows="4" placeholder="Please mention the reason for leave..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Upload Supporting Document (Optional)</label>
                                <input type="file" id="empLeaveDocument" class="form-control" accept=".pdf,.jpg,.png">
                                <small style="color: var(--gray);">Max size: 2MB</small>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-paper-plane"></i> Submit Leave Application
                            </button>
                        </form>
                    </div>
                </section>

                <!-- Employee Attendance History Section -->
                <section id="empHistorySection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-history"></i> My Attendance History</h2>
                            <div class="filter-bar">
                                <select id="empFilterMonth" class="form-control" style="width: 200px;">
                                    <option value="">Select Month</option>
                                </select>
                                <input type="number" id="empFilterYear" class="form-control" placeholder="Year" style="width: 150px;" value="2024">
                                <button class="btn btn-primary" id="empApplyFilterBtn">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Day</th>
                                        <th>In Time</th>
                                        <th>Out Time</th>
                                        <th>Status</th>
                                        <th>Location</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody id="empAttendanceTableBody">
                                    <!-- Attendance history will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="chart-container" style="margin-top: 30px;">
                            <h3><i class="fas fa-chart-line"></i> My Attendance Trend</h3>
                            <canvas id="empAttendanceChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Employee Leave Status Section -->
                <section id="empLeaveStatusSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-calendar-check"></i> My Leave Applications</h2>
                        </div>
                        
                        <div class="tabs">
                            <button class="tab active" data-tab="empPending">Pending</button>
                            <button class="tab" data-tab="empApproved">Approved</button>
                            <button class="tab" data-tab="empRejected">Rejected</button>
                        </div>
                        
                        <!-- Pending Leaves Tab -->
                        <div id="empPendingTab" class="tab-content active">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Applied On</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="empPendingLeavesTableBody">
                                        <!-- Pending leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Approved Leaves Tab -->
                        <div id="empApprovedTab" class="tab-content">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Applied On</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Approved On</th>
                                        </tr>
                                    </thead>
                                    <tbody id="empApprovedLeavesTableBody">
                                        <!-- Approved leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Rejected Leaves Tab -->
                        <div id="empRejectedTab" class="tab-content">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Applied On</th>
                                            <th>Leave Type</th>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Days</th>
                                            <th>Reason</th>
                                            <th>Rejected On</th>
                                        </tr>
                                    </thead>
                                    <tbody id="empRejectedLeavesTableBody">
                                        <!-- Rejected leaves will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NEW: Employee Training Section -->
                <section id="empTrainingSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-graduation-cap"></i> Training & Development</h2>
                        </div>
                        
                        <div class="training-cards">
                            <div class="training-card">
                                <h4><i class="fas fa-laptop-code"></i> System Training</h4>
                                <p>Learn how to use the AI Attendance System effectively</p>
                                <div class="progress-container">
                                    <span id="systemTrainingProgress">Completion: 0%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="systemTrainingBar" style="width: 0%;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" id="startSystemTraining">
                                    <i class="fas fa-play"></i> Start Training
                                </button>
                            </div>
                            
                            <div class="training-card">
                                <h4><i class="fas fa-shield-alt"></i> Security Awareness</h4>
                                <p>Learn about data security and privacy best practices</p>
                                <div class="progress-container">
                                    <span id="securityTrainingProgress">Completion: 0%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="securityTrainingBar" style="width: 0%;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" id="startSecurityTraining">
                                    <i class="fas fa-play"></i> Start Training
                                </button>
                            </div>
                            
                            <div class="training-card">
                                <h4><i class="fas fa-chart-line"></i> Productivity Training</h4>
                                <p>Improve your productivity with time management skills</p>
                                <div class="progress-container">
                                    <span id="productivityTrainingProgress">Completion: 0%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="productivityTrainingBar" style="width: 0%;"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" id="startProductivityTraining">
                                    <i class="fas fa-play"></i> Start Training
                                </button>
                            </div>
                        </div>
                        
                        <div class="chart-container" style="margin-top: 30px;">
                            <h3><i class="fas fa-chart-bar"></i> My Training Progress</h3>
                            <canvas id="empTrainingChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- NEW: Employee Profile Section -->
                <section id="empProfileSection" class="content-section">
                    <div class="records-container">
                        <div class="section-header">
                            <h2><i class="fas fa-user-cog"></i> My Profile</h2>
                        </div>
                        
                        <div class="two-column-layout">
                            <div>
                                <div class="form-group">
                                    <label>Employee ID</label>
                                    <input type="text" id="empProfileId" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" id="empProfileName" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Designation</label>
                                    <input type="text" id="empProfileDesignation" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Department</label>
                                    <input type="text" id="empProfileDepartment" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Office</label>
                                    <input type="text" id="empProfileOffice" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="empProfileEmail" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Contact Number</label>
                                    <input type="text" id="empProfileContact" class="form-control" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Joining Date</label>
                                    <input type="text" id="empProfileJoiningDate" class="form-control" readonly>
                                </div>
                            </div>
                            
                            <div>
                                <div class="password-change-container">
                                    <h4><i class="fas fa-key"></i> Change Password</h4>
                                    <form id="empPasswordForm">
                                        <div class="form-group">
                                            <label>Current Password</label>
                                            <input type="password" id="currentPassword" class="form-control" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label>New Password</label>
                                            <input type="password" id="newPassword" class="form-control" required minlength="6">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label>Confirm New Password</label>
                                            <input type="password" id="confirmPassword" class="form-control" required>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                                            <i class="fas fa-save"></i> Change Password
                                        </button>
                                    </form>
                                </div>
                                
                                <div class="employee-geofence-settings" style="margin-top: 30px;">
                                    <h4><i class="fas fa-bell"></i> Notification Preferences</h4>
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="empEmailNotifications" checked>
                                            <span>Email Notifications</span>
                                        </label>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="empSMSNotifications" checked>
                                            <span>SMS Notifications</span>
                                        </label>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 15px;">
                                        <label style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="empPushNotifications" checked>
                                            <span>Push Notifications</span>
                                        </label>
                                    </div>
                                    <button class="btn btn-primary" id="saveEmpNotificationSettings">
                                        <i class="fas fa-save"></i> Save Preferences
                                    </button>
                                </div>
                                
                                <!-- Mobile App QR -->
                                <div class="qr-container" style="margin-top: 30px;">
                                    <h4><i class="fas fa-mobile-alt"></i> Mobile App</h4>
                                    <p>Scan to install mobile app</p>
                                    <div class="qr-code">
                                        <i class="fas fa-qrcode" style="font-size: 80px; color: var(--primary);"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Employee Modal -->
    <div class="modal-overlay" id="employeeModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Employee</h3>
                <button class="close-modal" id="closeModalBtn">&times;</button>
            </div>
            
            <form id="employeeForm">
                <input type="hidden" id="employeeId">
                
                <div class="form-group">
                    <label for="empName">Full Name</label>
                    <input type="text" id="empName" class="form-control" required placeholder="Enter full name">
                </div>
                
                <div class="form-group">
                    <label for="empDepartment">Department</label>
                    <select id="empDepartment" class="form-control" required>
                        <option value="">Select Department</option>
                        <option value="  ">Panchayati Raj Department</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="empOffice">Office Name</label>
                    <select id="empOffice" class="form-control" required>
                        <option value="">Select Office</option>
                        <option value="  ">Sheikhpura Panchayat Office</option>
                        <option value="  ">Headquarters Panchayat Office</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="empDesignation">Designation</label>
                    <select id="empDesignation" class="form-control" required>
                        <option value="">Select Designation</option>
                        <option value="DATA ENTRY OPERATOR">DATA ENTRY OPERATOR</option>
                        <option value="EXECUTIVE ASSISTANT">EXECUTIVE ASSISTANT</option>
                        <option value="PANCHAYATI RAJ OFFICER">PANCHAYATI RAJ OFFICER</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="empContact">Contact Number</label>
                    <input type="tel" id="empContact" class="form-control" placeholder="Enter contact number">
                </div>
                
                <div class="form-group">
                    <label for="empEmail">Email Address</label>
                    <input type="email" id="empEmail" class="form-control" placeholder="Enter email address">
                </div>
                
                <div class="form-group">
                    <label for="empJoiningDate">Joining Date</label>
                    <input type="date" id="empJoiningDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="empLoginId">Login ID (Auto-generated)</label>
                    <input type="text" id="empLoginId" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label for="empPassword">Default Password</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="empPassword" class="form-control" readonly>
                        <button type="button" class="btn" id="generatePasswordBtn" style="white-space: nowrap;">
                            <i class="fas fa-redo"></i> Generate
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-save"></i> Save Employee
                </button>
            </form>
        </div>
    </div>

    <!-- Leave Action Modal -->
    <div class="modal-overlay" id="leaveActionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="leaveModalTitle">Leave Application Action</h3>
                <button class="close-modal" id="closeLeaveModalBtn">&times;</button>
            </div>
            
            <div id="leaveActionForm">
                <input type="hidden" id="leaveActionId">
                <input type="hidden" id="leaveActionType">
                
                <div class="form-group">
                    <label>Employee Name</label>
                    <input type="text" id="leaveEmployeeName" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label>Leave Type</label>
                    <input type="text" id="leaveTypeDisplay" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label>Leave Period</label>
                    <input type="text" id="leavePeriod" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label>Number of Days</label>
                    <input type="text" id="leaveDaysDisplay" class="form-control" readonly>
                </div>
                
                <div class="form-group">
                    <label>Reason</label>
                    <textarea id="leaveReasonDisplay" class="form-control" rows="3" readonly></textarea>
                </div>
                
                <div id="rejectionReasonSection" style="display: none;">
                    <div class="form-group">
                        <label for="rejectionReason">Reason for Rejection</label>
                        <textarea id="rejectionReason" class="form-control" rows="3" placeholder="Enter reason for rejecting this leave application"></textarea>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button type="button" class="btn btn-success" id="confirmApproveBtn" style="display: none;">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmRejectBtn" style="display: none;">
                        <i class="fas fa-times"></i> Reject
                    </button>
                    <button type="button" class="btn" id="cancelLeaveActionBtn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotPasswordModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Forgot Password</h3>
                <button class="close-modal" id="closeForgotPasswordBtn">&times;</button>
            </div>
            
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotUsername">User ID</label>
                    <input type="text" id="forgotUsername" class="form-control" placeholder="Enter your user ID" required>
                </div>
                
                <div class="form-group">
                    <label for="forgotEmail">Email Address</label>
                    <input type="email" id="forgotEmail" class="form-control" placeholder="Enter registered email" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-paper-plane"></i> Send Reset Link
                </button>
                
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: var(--gray); font-size: 14px;">
                        <i class="fas fa-info-circle"></i> Reset link will be sent to your email
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Training Modal -->
    <div class="modal-overlay" id="trainingModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="trainingModalTitle">System Training</h3>
                <button class="close-modal" id="closeTrainingModalBtn">&times;</button>
            </div>
            
            <div id="trainingContent">
                <div style="text-align: center; margin-bottom: 30px;">
                    <i class="fas fa-graduation-cap" style="font-size: 60px; color: var(--primary); margin-bottom: 20px;"></i>
                    <h4>Welcome to the Training Module</h4>
                </div>
                
                <div id="trainingSteps">
                    <!-- Training steps will be loaded here -->
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                    <button class="btn" id="prevTrainingStep">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="nextTrainingStep">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- JavaScript -->
    <script>
        // App State
        const AppState = {
            isAuthenticated: false,
            currentUser: null,
            currentUserType: null,
            employees: [],
            attendanceRecords: [],
            leaveApplications: [],
            notifications: [],
            trainingProgress: {},
            currentStream: null,
            capturedPhoto: null,
            currentLocation: null,
            geofence: { lat: 25.5941, lng: 85.1376, radius: 100 },
            geofenceEnabled: true,
            map: null,
            charts: {},
            
            init() {
                this.loadData();
                this.setupEventListeners();
                this.initializeDemoData();
                this.hideLoading();
                this.setupLoginType();
                this.setupCharts();
            },
            
            setupLoginType() {
                const adminLoginBtn = document.getElementById('adminLoginBtn');
                const employeeLoginBtn = document.getElementById('employeeLoginBtn');
                const loginTypeField = document.getElementById('loginType');
                
                adminLoginBtn.addEventListener('click', () => {
                    adminLoginBtn.classList.add('active');
                    employeeLoginBtn.classList.remove('active');
                    loginTypeField.value = 'admin';
                });
                
                employeeLoginBtn.addEventListener('click', () => {
                    employeeLoginBtn.classList.add('active');
                    adminLoginBtn.classList.remove('active');
                    loginTypeField.value = 'employee';
                });
            },
            
            loadData() {
                try {
                    const savedEmployees = localStorage.getItem('panchayat_employees');
                    const savedRecords = localStorage.getItem('panchayat_attendance');
                    const savedLeaves = localStorage.getItem('panchayat_leaves');
                    const savedGeofence = localStorage.getItem('panchayat_geofence');
                    const savedSettings = localStorage.getItem('panchayat_settings');
                    const savedNotifications = localStorage.getItem('panchayat_notifications');
                    const savedTraining = localStorage.getItem('panchayat_training');
                    
                    if (savedEmployees) {
                        this.employees = JSON.parse(savedEmployees);
                    }
                    
                    if (savedRecords) {
                        this.attendanceRecords = JSON.parse(savedRecords);
                    }
                    
                    if (savedLeaves) {
                        this.leaveApplications = JSON.parse(savedLeaves);
                    }
                    
                    if (savedGeofence) {
                        this.geofence = JSON.parse(savedGeofence);
                    }
                    
                    if (savedSettings) {
                        const settings = JSON.parse(savedSettings);
                        this.geofenceEnabled = settings.enableGeofence !== false;
                    }
                    
                    if (savedNotifications) {
                        this.notifications = JSON.parse(savedNotifications);
                    }
                    
                    if (savedTraining) {
                        this.trainingProgress = JSON.parse(savedTraining);
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            },
            
            saveData() {
                try {
                    localStorage.setItem('panchayat_employees', JSON.stringify(this.employees));
                    localStorage.setItem('panchayat_attendance', JSON.stringify(this.attendanceRecords));
                    localStorage.setItem('panchayat_leaves', JSON.stringify(this.leaveApplications));
                    localStorage.setItem('panchayat_geofence', JSON.stringify(this.geofence));
                    localStorage.setItem('panchayat_notifications', JSON.stringify(this.notifications));
                    localStorage.setItem('panchayat_training', JSON.stringify(this.trainingProgress));
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            },
            
            calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371e3;
                const 1 = lat1 * Math.PI / 180;
                const 2 = lat2 * Math.PI / 180;
                const  = (lat2 - lat1) * Math.PI / 180;
                const  = (lon2 - lon1) * Math.PI / 180;
                
                const a = Math.sin( / 2) * Math.sin( / 2) +
                          Math.cos(1) * Math.cos(2) *
                          Math.sin( / 2) * Math.sin( / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                
                return R * c;
            },
            
            isWithinGeofence(location) {
                if (!this.geofenceEnabled || !location || !this.geofence) return true;
                
                const distance = this.calculateDistance(
                    location.lat, location.lng,
                    this.geofence.lat, this.geofence.lng
                );
                
                return distance <= this.geofence.radius;
            },
            
            initializeDemoData() {
                // Initialize employees
                if (this.employees.length === 0) {
                    this.employees = [
                        { 
                            id: 1, 
                            name: 'AMRENDRA KUMAR', 
                            department: '  ', 
                            office: '  ',
                            designation: 'DATA ENTRY OPERATOR', 
                            contact: '1234567890',
                            email: 'amrendra@example.com',
                            loginId: 'E001',
                            password: 'E001',
                            status: 'active',
                            joiningDate: '2023-01-15'
                        },
                        { 
                            id: 2, 
                            name: 'SULOK KUMAR', 
                            department: '  ', 
                            office: '  ',
                            designation: 'DATA ENTRY OPERATOR', 
                            contact: '9876543210',
                            email: 'sulok@example.com',
                            loginId: 'E002',
                            password: 'E002',
                            status: 'active',
                            joiningDate: '2023-02-20'
                        },
                        { 
                            id: 3, 
                            name: 'DHIRAJ KUMAR', 
                            department: '  ', 
                            office: '  ',
                            designation: 'EXECUTIVE ASSISTANT', 
                            contact: '8765432109',
                            email: 'dhiraj@example.com',
                            loginId: 'E003',
                            password: 'E003',
                            status: 'active',
                            joiningDate: '2023-03-10'
                        }
                    ];
                }
                
                // Initialize attendance records
                if (this.attendanceRecords.length === 0) {
                    const today = new Date().toISOString().split('T')[0];
                    this.attendanceRecords = [
                        {
                            id: 1,
                            employeeId: 1,
                            name: 'AMRENDRA KUMAR',
                            department: '  ',
                            office: '  ',
                            designation: 'DATA ENTRY OPERATOR',
                            time: '09:15 AM',
                            date: today,
                            status: 'present',
                            location: '25.5941, 85.1376',
                            ip: '192.168.1.1',
                            remarks: 'On time'
                        }
                    ];
                }
                
                // Initialize leave applications
                if (this.leaveApplications.length === 0) {
                    const today = new Date();
                    const fromDate = new Date(today);
                    fromDate.setDate(today.getDate() + 2);
                    const toDate = new Date(fromDate);
                    toDate.setDate(fromDate.getDate() + 2);
                    
                    this.leaveApplications = [
                        {
                            id: 1,
                            employeeId: 1,
                            employeeName: 'AMRENDRA KUMAR',
                            leaveType: 'casual',
                            fromDate: fromDate.toISOString().split('T')[0],
                            toDate: toDate.toISOString().split('T')[0],
                            days: 3,
                            reason: 'Family function',
                            status: 'pending',
                            appliedOn: today.toISOString().split('T')[0]
                        }
                    ];
                }
                
                // Initialize notifications
                if (this.notifications.length === 0) {
                    this.notifications = [
                        {
                            id: 1,
                            title: 'System Update',
                            message: 'AI Attendance System has been updated to version 2.0',
                            type: 'system',
                            time: '2 hours ago',
                            read: false
                        },
                        {
                            id: 2,
                            title: 'Leave Approved',
                            message: 'Your leave application has been approved',
                            type: 'success',
                            time: '1 day ago',
                            read: true
                        },
                        {
                            id: 3,
                            title: 'Training Available',
                            message: 'New training module available: Security Awareness',
                            type: 'info',
                            time: '3 days ago',
                            read: false
                        }
                    ];
                }
                
                // Initialize training progress
                if (Object.keys(this.trainingProgress).length === 0) {
                    this.trainingProgress = {
                        systemTraining: 0,
                        securityTraining: 0,
                        productivityTraining: 0
                    };
                }
                
                this.saveData();
            },
            
            setupEventListeners() {
                // Login Form
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });
                
                // Forgot Password
                document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showForgotPasswordModal();
                });
                
                // Close Forgot Password Modal
                document.getElementById('closeForgotPasswordBtn').addEventListener('click', () => {
                    this.closeForgotPasswordModal();
                });
                
                // Admin Logout
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.handleLogout();
                });
                
                // Employee Logout
                document.getElementById('employeeLogoutBtn').addEventListener('click', () => {
                    this.handleEmployeeLogout();
                });
                
                // Admin Navigation
                document.querySelectorAll('#mainApp .nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.currentTarget.dataset.section;
                        this.showSection(section, 'admin');
                    });
                });
                
                // Employee Navigation
                document.querySelectorAll('#employeeApp .nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.currentTarget.dataset.section;
                        this.showSection(section, 'employee');
                    });
                });
                
                // Tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.currentTarget.dataset.tab;
                        const isEmployeeTab = e.currentTarget.closest('#employeeApp') !== null;
                        this.showTab(tabId, isEmployeeTab ? 'employee' : 'admin');
                    });
                });
                
                // Quick Actions
                document.getElementById('quickMarkAttendance').addEventListener('click', () => {
                    this.showSection('attendance', 'admin');
                });
                
                document.getElementById('quickViewRecords').addEventListener('click', () => {
                    this.showSection('records', 'admin');
                });
                
                document.getElementById('quickAddEmployee').addEventListener('click', () => {
                    this.showEmployeeModal();
                });
                
                document.getElementById('quickManageLeaves').addEventListener('click', () => {
                    this.showSection('leaves', 'admin');
                });
                
                // Employee Quick Actions
                document.getElementById('empQuickAttendance').addEventListener('click', () => {
                    this.showSection('empAttendance', 'employee');
                });
                
                document.getElementById('empQuickLeave').addEventListener('click', () => {
                    this.showSection('empLeave', 'employee');
                });
                
                document.getElementById('empQuickHistory').addEventListener('click', () => {
                    this.showSection('empHistory', 'employee');
                });
                
                document.getElementById('empQuickTraining').addEventListener('click', () => {
                    this.showSection('empTraining', 'employee');
                });
                
                // Camera Controls (Admin)
                document.getElementById('startCameraBtn').addEventListener('click', () => {
                    this.startCamera(false);
                });
                
                document.getElementById('capturePhotoBtn').addEventListener('click', () => {
                    this.capturePhoto(false);
                });
                
                document.getElementById('stopCameraBtn').addEventListener('click', () => {
                    this.stopCamera(false);
                });
                
                // Manual Attendance Entry
                document.getElementById('markManualBtn').addEventListener('click', () => {
                    this.markManualAttendance();
                });
                
                // Camera Controls (Employee)
                document.getElementById('empStartCameraBtn').addEventListener('click', () => {
                    this.startCamera(true);
                });
                
                document.getElementById('empCapturePhotoBtn').addEventListener('click', () => {
                    this.capturePhoto(true);
                });
                
                document.getElementById('empStopCameraBtn').addEventListener('click', () => {
                    this.stopCamera(true);
                });
                
                // Employee Biometric Options
                document.getElementById('useBiometricBtn').addEventListener('click', () => {
                    this.useBiometric();
                });
                
                document.getElementById('useManualBtn').addEventListener('click', () => {
                    this.useManualEntry();
                });
                
                // Mark Attendance (Admin)
                document.getElementById('markAttendanceBtn').addEventListener('click', () => {
                    this.markAttendance(false);
                });
                
                // Mark Attendance (Employee)
                document.getElementById('empMarkAttendanceBtn').addEventListener('click', () => {
                    this.markAttendance(true);
                });
                
                // Employee Management
                document.getElementById('addEmployeeBtn').addEventListener('click', () => {
                    this.showEmployeeModal();
                });
                
                document.getElementById('closeModalBtn').addEventListener('click', () => {
                    this.closeEmployeeModal();
                });
                
                // Employee Form
                document.getElementById('employeeForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveEmployee();
                });
                
                // Generate Password Button
                document.getElementById('generatePasswordBtn').addEventListener('click', () => {
                    this.generatePassword();
                });
                
                // Use current location for geofence
                document.getElementById('useCurrentLocationBtn').addEventListener('click', () => {
                    if (this.currentLocation) {
                        document.getElementById('geofenceLat').value = this.currentLocation.lat.toFixed(6);
                        document.getElementById('geofenceLng').value = this.currentLocation.lng.toFixed(6);
                        this.updateGeofenceMap();
                        this.showNotification('Current location set', 'success');
                    } else {
                        this.showNotification('Location not available', 'error');
                    }
                });
                
                // Save geofence
                document.getElementById('saveGeofenceBtn').addEventListener('click', () => {
                    this.saveGeofence();
                });
                
                // Leave Application Form (Employee)
                document.getElementById('empLeaveForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitLeaveApplication();
                });
                
                // Leave date calculation
                document.getElementById('empLeaveFromDate').addEventListener('change', () => {
                    this.calculateLeaveDays();
                });
                
                document.getElementById('empLeaveToDate').addEventListener('change', () => {
                    this.calculateLeaveDays();
                });
                
                // Employee Password Change
                document.getElementById('empPasswordForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.changeEmployeePassword();
                });
                
                // Employee Notification Settings
                document.getElementById('saveEmpNotificationSettings').addEventListener('click', () => {
                    this.saveEmployeeNotificationSettings();
                });
                
                // Training Start Buttons
                document.getElementById('startSystemTraining').addEventListener('click', () => {
                    this.startTraining('systemTraining');
                });
                
                document.getElementById('startSecurityTraining').addEventListener('click', () => {
                    this.startTraining('securityTraining');
                });
                
                document.getElementById('startProductivityTraining').addEventListener('click', () => {
                    this.startTraining('productivityTraining');
                });
                
                // Reports
                document.getElementById('generateDailyReport').addEventListener('click', () => {
                    this.generateReport('daily');
                });
                
                document.getElementById('generateMonthlyReport').addEventListener('click', () => {
                    this.generateReport('monthly');
                });
                
                document.getElementById('generateDeptReport').addEventListener('click', () => {
                    this.generateReport('department');
                });
                
                document.getElementById('generateLeaveReport').addEventListener('click', () => {
                    this.generateReport('leave');
                });
                
                // Records
                document.getElementById('applyFilterBtn').addEventListener('click', () => {
                    this.filterRecords();
                });
                
                document.getElementById('resetFilterBtn').addEventListener('click', () => {
                    this.resetFilters();
                });
                
                document.getElementById('exportRecordsBtn').addEventListener('click', () => {
                    this.exportRecords();
                });
                
                document.getElementById('exportPDFBtn').addEventListener('click', () => {
                    this.exportPDF();
                });
                
                // Employee Attendance History Filter
                document.getElementById('empApplyFilterBtn').addEventListener('click', () => {
                    this.loadEmployeeAttendanceHistory();
                });
                
                // Settings
                document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                    this.saveSettings();
                });
                
                document.getElementById('resetSettingsBtn').addEventListener('click', () => {
                    this.resetSettings();
                });
                
                // Data Management
                document.getElementById('backupDataBtn').addEventListener('click', () => {
                    this.backupData();
                });
                
                document.getElementById('restoreDataBtn').addEventListener('click', () => {
                    this.restoreData();
                });
                
                document.getElementById('clearDataBtn').addEventListener('click', () => {
                    this.clearData();
                });
                
                // Employee Select Change (Admin Attendance Section)
                document.getElementById('attendanceEmployee').addEventListener('change', (e) => {
                    this.onEmployeeSelect(e.target.value);
                });
                
                // Close Leave Action Modal
                document.getElementById('closeLeaveModalBtn').addEventListener('click', () => {
                    this.closeLeaveActionModal();
                });
                
                document.getElementById('cancelLeaveActionBtn').addEventListener('click', () => {
                    this.closeLeaveActionModal();
                });
                
                // Leave Approval/Rejection Buttons
                document.getElementById('confirmApproveBtn').addEventListener('click', () => {
                    this.approveLeaveApplication();
                });
                
                document.getElementById('confirmRejectBtn').addEventListener('click', () => {
                    this.rejectLeaveApplication();
                });
                
                // Notification Bell
                document.getElementById('notificationBell').addEventListener('click', () => {
                    this.showSection('notifications', 'admin');
                });
                
                document.getElementById('empNotificationBell').addEventListener('click', () => {
                    // For employee, we'll show notification dropdown
                    this.showNotificationDropdown();
                });
                
                // Mark All Read
                document.getElementById('markAllReadBtn').addEventListener('click', () => {
                    this.markAllNotificationsRead();
                });
                
                // Biometric Settings
                document.getElementById('saveBiometricSettings').addEventListener('click', () => {
                    this.saveBiometricSettings();
                });
                
                // Import Employees
                document.getElementById('importEmployeesBtn').addEventListener('click', () => {
                    this.importEmployees();
                });
            },
            
            handleLogin() {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                const loginType = document.getElementById('loginType').value;
                
                console.log('Login attempt:', { username, password, loginType });
                
                if (loginType === 'admin') {
                    if (username === 'Barbigha' && password === 'Barbigha') {
                        this.isAuthenticated = true;
                        this.currentUser = { 
                            name: 'Administrator', 
                            role: 'System Admin',
                            type: 'admin'
                        };
                        this.currentUserType = 'admin';
                        
                        document.getElementById('loginPage').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        document.getElementById('employeeApp').style.display = 'none';
                        
                        this.updateUserInfo();
                        this.loadEmployees();
                        this.updateDashboard();
                        this.updateSidebarStats();
                        this.loadLeaveApplications();
                        this.updateNotificationCount();
                        
                        this.showNotification('Admin login successful!', 'success');
                        
                        this.getCurrentLocation();
                        this.getIPAddress();
                        
                    } else {
                        this.showNotification('Invalid admin credentials', 'error');
                    }
                } else {
                    // Employee login logic - FIXED
                    console.log('Looking for employee with:', username, password);
                    console.log('Available employees:', this.employees);
                    
                    // Fixed: Case-insensitive comparison for employee login
                    const employee = this.employees.find(emp => {
                        const loginMatch = emp.loginId && emp.loginId.toLowerCase() === username.toLowerCase();
                        const passwordMatch = emp.password && emp.password.toLowerCase() === password.toLowerCase();
                        const statusMatch = emp.status === 'active';
                        
                        console.log('Checking:', emp.loginId, 'vs', username, '=', loginMatch);
                        console.log('Password match:', passwordMatch);
                        console.log('Status active:', statusMatch);
                        
                        return loginMatch && passwordMatch && statusMatch;
                    });
                    
                    if (employee) {
                        console.log('Employee found:', employee);
                        this.isAuthenticated = true;
                        this.currentUser = {
                            id: employee.id,
                            name: employee.name,
                            role: employee.designation,
                            type: 'employee',
                            department: employee.department,
                            office: employee.office,
                            contact: employee.contact,
                            email: employee.email,
                            joiningDate: employee.joiningDate
                        };
                        this.currentUserType = 'employee';
                        
                        document.getElementById('loginPage').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'none';
                        document.getElementById('employeeApp').style.display = 'block';
                        
                        this.updateEmployeeUserInfo();
                        this.loadEmployeeDashboard();
                        this.initEmployeeAttendanceSection();
                        this.updateEmployeeNotificationCount();
                        
                        this.showNotification(`Welcome ${employee.name}!`, 'success');
                        
                        this.getCurrentLocation();
                        this.getIPAddress();
                        
                    } else {
                        console.log('No employee found matching credentials');
                        this.showNotification('Invalid employee credentials or account inactive', 'error');
                    }
                }
            },
            
            handleLogout() {
                if (confirm('Are you sure you want to logout?')) {
                    this.isAuthenticated = false;
                    this.currentUser = null;
                    this.currentUserType = null;
                    
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'block';
                    
                    document.getElementById('loginForm').reset();
                    
                    this.showNotification('Logged out successfully', 'success');
                }
            },
            
            handleEmployeeLogout() {
                if (confirm('Are you sure you want to logout?')) {
                    this.isAuthenticated = false;
                    this.currentUser = null;
                    this.currentUserType = null;
                    
                    document.getElementById('employeeApp').style.display = 'none';
                    document.getElementById('loginPage').style.display = 'block';
                    
                    document.getElementById('loginForm').reset();
                    
                    this.showNotification('Logged out successfully', 'success');
                }
            },
            
            showForgotPasswordModal() {
                document.getElementById('forgotPasswordModal').style.display = 'flex';
            },
            
            closeForgotPasswordModal() {
                document.getElementById('forgotPasswordModal').style.display = 'none';
                document.getElementById('forgotPasswordForm').reset();
            },
            
            showSection(section, userType) {
                if (userType === 'admin') {
                    document.querySelectorAll('#mainApp .content-section').forEach(sec => {
                        sec.classList.remove('active');
                    });
                    
                    document.querySelectorAll('#mainApp .nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    
                    const sectionElement = document.getElementById(section + 'Section');
                    if (sectionElement) {
                        sectionElement.classList.add('active');
                    }
                    
                    const navLink = document.querySelector(`#mainApp .nav-link[data-section="${section}"]`);
                    if (navLink) {
                        navLink.classList.add('active');
                    }
                    
                    switch(section) {
                        case 'attendance':
                            this.initAttendanceSection();
                            break;
                        case 'records':
                            this.loadRecords();
                            break;
                        case 'employees':
                            this.loadEmployeesTable();
                            break;
                        case 'leaves':
                            this.loadLeaveApplications();
                            break;
                        case 'geofence':
                            this.initGeofenceSection();
                            break;
                        case 'dashboard':
                            this.updateDashboard();
                            break;
                        case 'analytics':
                            this.initAnalytics();
                            break;
                        case 'training':
                            this.initTraining();
                            break;
                        case 'biometric':
                            this.initBiometric();
                            break;
                        case 'notifications':
                            this.loadNotifications();
                            break;
                    }
                } else {
                    document.querySelectorAll('#employeeApp .content-section').forEach(sec => {
                        sec.classList.remove('active');
                    });
                    
                    document.querySelectorAll('#employeeApp .nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    
                    const sectionElement = document.getElementById(section + 'Section');
                    if (sectionElement) {
                        sectionElement.classList.add('active');
                    }
                    
                    const navLink = document.querySelector(`#employeeApp .nav-link[data-section="${section}"]`);
                    if (navLink) {
                        navLink.classList.add('active');
                    }
                    
                    switch(section) {
                        case 'empAttendance':
                            this.initEmployeeAttendanceSection();
                            break;
                        case 'empLeave':
                            this.initEmployeeLeaveSection();
                            break;
                        case 'empHistory':
                            this.loadEmployeeAttendanceHistory();
                            break;
                        case 'empLeaveStatus':
                            this.loadEmployeeLeaveStatus();
                            break;
                        case 'empDashboard':
                            this.loadEmployeeDashboard();
                            break;
                        case 'empTraining':
                            this.initEmployeeTraining();
                            break;
                        case 'empProfile':
                            this.initEmployeeProfile();
                            break;
                    }
                }
            },
            
            showTab(tabId, userType) {
                const prefix = userType === 'employee' ? 'emp' : '';
                const containerId = userType === 'employee' ? 'employeeApp' : 'mainApp';
                
                document.querySelectorAll(`#${containerId} .tab`).forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelectorAll(`#${containerId} .tab-content`).forEach(content => {
                    content.classList.remove('active');
                });
                
                const tabElement = document.querySelector(`#${containerId} .tab[data-tab="${tabId}"]`);
                if (tabElement) {
                    tabElement.classList.add('active');
                }
                
                const tabContent = document.getElementById(prefix + tabId + 'Tab');
                if (tabContent) {
                    tabContent.classList.add('active');
                }
            },
            
            updateUserInfo() {
                document.getElementById('currentUserName').textContent = this.currentUser.name;
                document.getElementById('currentUserRole').textContent = this.currentUser.role;
            },
            
            updateEmployeeUserInfo() {
                document.getElementById('employeeUserName').textContent = this.currentUser.name;
                document.getElementById('employeeUserRole').textContent = this.currentUser.role;
                
                document.getElementById('empWelcomeMessage').textContent = `Welcome, ${this.currentUser.name}`;
                document.getElementById('empWelcomeDetails').textContent = `${this.currentUser.role} | ${this.currentUser.department}`;
                
                this.updateEmployeeCurrentTime();
                setInterval(() => this.updateEmployeeCurrentTime(), 1000);
            },
            
            updateEmployeeCurrentTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true 
                });
                const dateString = now.toLocaleDateString('en-IN', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                document.getElementById('empCurrentTime').textContent = `${dateString} | ${timeString}`;
                if (document.getElementById('empCurrentTime2')) {
                    document.getElementById('empCurrentTime2').textContent = timeString;
                }
            },
            
            loadEmployees() {
                const select = document.getElementById('attendanceEmployee');
                const filterSelect = document.getElementById('filterEmployee');
                const leaveFilterSelect = document.getElementById('filterLeaveEmployee');
                const geofenceSelect = document.getElementById('employeeGeofenceSelect');
                
                // Clear options
                [select, filterSelect, leaveFilterSelect, geofenceSelect].forEach(el => {
                    if (el) {
                        el.innerHTML = '';
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = el === geofenceSelect ? 
                            'Select Employee to Set Individual Geofence' : 
                            '-- Select Employee --';
                        el.appendChild(defaultOption);
                    }
                });
                
                this.employees.forEach(employee => {
                    // Attendance select
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    select.appendChild(option);
                    
                    // Filter select
                    const filterOption = document.createElement('option');
                    filterOption.value = employee.id;
                    filterOption.textContent = employee.name;
                    filterSelect.appendChild(filterOption);
                    
                    // Leave filter select
                    if (leaveFilterSelect) {
                        const leaveFilterOption = document.createElement('option');
                        leaveFilterOption.value = employee.id;
                        leaveFilterOption.textContent = employee.name;
                        leaveFilterSelect.appendChild(leaveFilterOption);
                    }
                    
                    // Geofence select
                    if (geofenceSelect) {
                        const geofenceOption = document.createElement('option');
                        geofenceOption.value = employee.id;
                        geofenceOption.textContent = employee.name;
                        geofenceSelect.appendChild(geofenceOption);
                    }
                });
            },
            
            onEmployeeSelect(employeeId) {
                if (!employeeId) return;
                
                const employee = this.employees.find(emp => emp.id == employeeId);
                if (employee) {
                    document.getElementById('attendanceDepartment').value = employee.department;
                    document.getElementById('attendanceDesignation').value = employee.designation;
                    document.getElementById('attendanceOffice').value = employee.office;
                }
            },
            
            initAttendanceSection() {
                this.loadEmployees();
                this.updateCurrentTime();
                setInterval(() => this.updateCurrentTime(), 1000);
            },
            
            initEmployeeAttendanceSection() {
                const today = new Date().toISOString().split('T')[0];
                const employeeId = this.currentUser.id;
                const todayAttendance = this.attendanceRecords.find(record => 
                    record.employeeId == employeeId && record.date === today && record.status === 'present');
                
                if (todayAttendance) {
                    document.getElementById('empAlreadyMarked').style.display = 'block';
                    document.getElementById('empMarkedDetails').textContent = 
                        `Time: ${todayAttendance.time} | Location: ${todayAttendance.location}`;
                    
                    document.getElementById('empMarkAttendanceBtn').disabled = true;
                    document.getElementById('empStartCameraBtn').disabled = true;
                } else {
                    document.getElementById('empAlreadyMarked').style.display = 'none';
                    document.getElementById('empMarkAttendanceBtn').disabled = false;
                    document.getElementById('empStartCameraBtn').disabled = false;
                }
                
                document.getElementById('empAttendanceName').value = this.currentUser.name;
                document.getElementById('empAttendanceDepartment').value = this.currentUser.department;
                document.getElementById('empAttendanceDesignation').value = this.currentUser.role;
                document.getElementById('empAttendanceOffice').value = this.currentUser.office;
                
                this.updateEmployeeCurrentTime();
            },
            
            initEmployeeLeaveSection() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                
                document.getElementById('empLeaveFromDate').value = tomorrow.toISOString().split('T')[0];
                document.getElementById('empLeaveToDate').value = tomorrow.toISOString().split('T')[0];
                
                this.calculateLeaveDays();
            },
            
            calculateLeaveDays() {
                const fromDate = new Date(document.getElementById('empLeaveFromDate').value);
                const toDate = new Date(document.getElementById('empLeaveToDate').value);
                
                if (fromDate && toDate && fromDate <= toDate) {
                    const diffTime = Math.abs(toDate - fromDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    
                    document.getElementById('empLeaveDays').value = diffDays + ' day(s)';
                } else {
                    document.getElementById('empLeaveDays').value = '0 day(s)';
                }
            },
            
            updateCurrentTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true 
                });
                document.getElementById('currentTime').textContent = timeString;
            },
            
            async startCamera(isEmployee) {
                try {
                    const constraints = {
                        video: {
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            facingMode: 'user'
                        }
                    };
                    
                    this.currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                    const video = document.createElement('video');
                    video.srcObject = this.currentStream;
                    video.autoplay = true;
                    video.style.width = '100%';
                    video.style.height = '100%';
                    
                    const preview = document.getElementById(isEmployee ? 'empCameraPreview' : 'cameraPreview');
                    preview.innerHTML = '';
                    preview.appendChild(video);
                    
                    if (isEmployee) {
                        document.getElementById('empStartCameraBtn').disabled = true;
                        document.getElementById('empCapturePhotoBtn').disabled = false;
                        document.getElementById('empStopCameraBtn').disabled = false;
                    } else {
                        document.getElementById('startCameraBtn').disabled = true;
                        document.getElementById('capturePhotoBtn').disabled = false;
                        document.getElementById('stopCameraBtn').disabled = false;
                    }
                    
                } catch (error) {
                    console.error('Error accessing camera:', error);
                    this.showNotification('Could not access camera. Please check permissions.', 'error');
                }
            },
            
            capturePhoto(isEmployee) {
                const preview = document.getElementById(isEmployee ? 'empCameraPreview' : 'cameraPreview');
                const video = preview.querySelector('video');
                
                if (!video) return;
                
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const context = canvas.getContext('2d');
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Add timestamp and system info
                context.fillStyle = 'rgba(0, 0, 0, 0.5)';
                context.fillRect(0, 0, canvas.width, 30);
                context.fillStyle = 'white';
                context.font = '16px Arial';
                context.fillText(`Panchayati Raj Dept - ${new Date().toLocaleString()}`, 10, 20);
                
                this.capturedPhoto = canvas.toDataURL('image/jpeg');
                
                const img = document.createElement('img');
                img.src = this.capturedPhoto;
                img.style.width = '100%';
                img.style.height = '100%';
                preview.innerHTML = '';
                preview.appendChild(img);
                
                const now = new Date();
                if (isEmployee) {
                    document.getElementById('empPhotoCaptureTime').textContent = now.toLocaleTimeString('en-IN');
                } else {
                    document.getElementById('photoCaptureTime').textContent = now.toLocaleTimeString('en-IN');
                }
                
                if (isEmployee) {
                    const employeeId = this.currentUser.id;
                    if (this.geofenceEnabled && this.currentLocation) {
                        if (this.isWithinGeofence(this.currentLocation)) {
                            document.getElementById('empMarkAttendanceBtn').disabled = false;
                            document.getElementById('empGeofenceStatusText').textContent = 'Within allowed area';
                            document.getElementById('empGeofenceStatusText').style.color = 'green';
                            this.showNotification('Photo captured! You are within the allowed area.', 'success');
                        } else {
                            document.getElementById('empMarkAttendanceBtn').disabled = true;
                            document.getElementById('empGeofenceStatusText').textContent = 'Outside allowed area';
                            document.getElementById('empGeofenceStatusText').style.color = 'red';
                            this.showNotification('Photo captured! But you are outside the allowed area.', 'warning');
                        }
                    } else {
                        document.getElementById('empMarkAttendanceBtn').disabled = false;
                        this.showNotification('Photo captured successfully!', 'success');
                    }
                } else {
                    const employeeSelected = document.getElementById('attendanceEmployee').value;
                    if (employeeSelected) {
                        if (this.geofenceEnabled && this.currentLocation) {
                            if (this.isWithinGeofence(this.currentLocation)) {
                                document.getElementById('markAttendanceBtn').disabled = false;
                                document.getElementById('geofenceStatusText').textContent = 'Within allowed area';
                                document.getElementById('geofenceStatusText').style.color = 'green';
                                this.showNotification('Photo captured! You are within the allowed area.', 'success');
                            } else {
                                document.getElementById('markAttendanceBtn').disabled = true;
                                document.getElementById('geofenceStatusText').textContent = 'Outside allowed area';
                                document.getElementById('geofenceStatusText').style.color = 'red';
                                this.showNotification('Photo captured! But you are outside the allowed area.', 'warning');
                            }
                        } else {
                            document.getElementById('markAttendanceBtn').disabled = false;
                            this.showNotification('Photo captured successfully!', 'success');
                        }
                    }
                }
            },
            
            stopCamera(isEmployee) {
                if (this.currentStream) {
                    this.currentStream.getTracks().forEach(track => track.stop());
                    this.currentStream = null;
                }
                
                const preview = document.getElementById(isEmployee ? 'empCameraPreview' : 'cameraPreview');
                preview.innerHTML = '<i class="fas fa-camera"></i>';
                
                if (isEmployee) {
                    document.getElementById('empStartCameraBtn').disabled = false;
                    document.getElementById('empCapturePhotoBtn').disabled = true;
                    document.getElementById('empStopCameraBtn').disabled = true;
                    
                    this.capturedPhoto = null;
                    document.getElementById('empMarkAttendanceBtn').disabled = true;
                } else {
                    document.getElementById('startCameraBtn').disabled = false;
                    document.getElementById('capturePhotoBtn').disabled = true;
                    document.getElementById('stopCameraBtn').disabled = true;
                    
                    this.capturedPhoto = null;
                    document.getElementById('markAttendanceBtn').disabled = true;
                }
            },
            
            markManualAttendance() {
                const employeeId = document.getElementById('attendanceEmployee').value;
                const employee = this.employees.find(emp => emp.id == employeeId);
                const remarks = document.getElementById('attendanceRemarks').value;
                
                if (!employeeId || !employee) {
                    this.showNotification('Please select an employee', 'error');
                    return;
                }
                
                const now = new Date();
                const attendanceRecord = {
                    id: Date.now(),
                    employeeId: parseInt(employeeId),
                    name: employee.name,
                    department: employee.department,
                    office: employee.office,
                    designation: employee.designation,
                    time: now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true }),
                    date: now.toISOString().split('T')[0],
                    status: 'present',
                    location: 'Manual Entry',
                    ip: 'N/A',
                    remarks: remarks || 'Manual entry by admin',
                    markedBy: 'Admin'
                };
                
                this.attendanceRecords.unshift(attendanceRecord);
                this.saveData();
                
                document.getElementById('attendanceEmployee').value = '';
                document.getElementById('attendanceDepartment').value = '';
                document.getElementById('attendanceDesignation').value = '';
                document.getElementById('attendanceOffice').value = '';
                document.getElementById('attendanceRemarks').value = '';
                
                this.showNotification(`Attendance manually marked for ${employee.name}`, 'success');
                this.updateDashboard();
                this.updateSidebarStats();
            },
            
            useBiometric() {
                // Simulate biometric authentication
                this.showNotification('Biometric authentication started. Please use your fingerprint scanner.', 'info');
                
                // Simulate delay for biometric scan
                setTimeout(() => {
                    this.showNotification('Biometric authentication successful!', 'success');
                    document.getElementById('empMarkAttendanceBtn').disabled = false;
                    
                    // Simulate photo capture for biometric
                    const now = new Date();
                    document.getElementById('empPhotoCaptureTime').textContent = now.toLocaleTimeString('en-IN') + ' (Biometric)';
                    this.capturedPhoto = 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="100%" height="100%" fill="#1a237e"/><text x="50%" y="50%" font-family="Arial" font-size="24" fill="white" text-anchor="middle" dy=".3em">Biometric Verified</text></svg>');
                    
                    const preview = document.getElementById('empCameraPreview');
                    preview.innerHTML = '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#1a237e;color:white;font-size:20px;">Biometric Verified </div>';
                }, 2000);
            },
            
            useManualEntry() {
                const reason = prompt('Please enter reason for manual attendance:');
                if (reason) {
                    this.showNotification('Manual entry approved. You can now mark attendance.', 'success');
                    document.getElementById('empMarkAttendanceBtn').disabled = false;
                    document.getElementById('empAttendanceRemarks').value = `Manual Entry: ${reason}`;
                }
            },
            
            getCurrentLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.currentLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            document.getElementById('locationCoordinates').textContent = 
                                `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;
                            
                            if (document.getElementById('empLocationCoordinates')) {
                                document.getElementById('empLocationCoordinates').textContent = 
                                    `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;
                            }
                            
                            if (this.currentUserType === 'employee') {
                                const withinGeofence = this.isWithinGeofence(this.currentLocation);
                                document.getElementById('empGeofenceStatusText').textContent = 
                                    withinGeofence ? 'Within allowed area' : 'Outside allowed area';
                                document.getElementById('empGeofenceStatusText').style.color = 
                                    withinGeofence ? 'green' : 'red';
                            }
                        },
                        (error) => {
                            console.error('Geolocation error:', error);
                            document.getElementById('locationCoordinates').textContent = 'Location not available';
                            
                            if (document.getElementById('empLocationCoordinates')) {
                                document.getElementById('empLocationCoordinates').textContent = 'Location not available';
                            }
                        }
                    );
                } else {
                    document.getElementById('locationCoordinates').textContent = 'Geolocation not supported';
                    if (document.getElementById('empLocationCoordinates')) {
                        document.getElementById('empLocationCoordinates').textContent = 'Geolocation not supported';
                    }
                }
            },
            
            async getIPAddress() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    document.getElementById('ipAddress').textContent = data.ip;
                    if (document.getElementById('empIpAddress')) {
                        document.getElementById('empIpAddress').textContent = data.ip;
                    }
                } catch (error) {
                    document.getElementById('ipAddress').textContent = 'IP not available';
                    if (document.getElementById('empIpAddress')) {
                        document.getElementById('empIpAddress').textContent = 'IP not available';
                    }
                }
            },
            
            markAttendance(isEmployee) {
                let employeeId, employee, remarks;
                
                if (isEmployee) {
                    employeeId = this.currentUser.id;
                    employee = this.employees.find(emp => emp.id == employeeId);
                    remarks = document.getElementById('empAttendanceRemarks').value;
                } else {
                    employeeId = document.getElementById('attendanceEmployee').value;
                    employee = this.employees.find(emp => emp.id == employeeId);
                    remarks = document.getElementById('attendanceRemarks').value;
                }
                
                if (!employeeId || !employee) {
                    this.showNotification('Please select an employee', 'error');
                    return;
                }
                
                if (!this.capturedPhoto && !remarks.includes('Manual Entry') && !remarks.includes('Biometric')) {
                    this.showNotification('Please capture a photo first or use manual/biometric entry', 'error');
                    return;
                }
                
                if (this.geofenceEnabled && !remarks.includes('Manual Entry')) {
                    if (!this.isWithinGeofence(this.currentLocation)) {
                        this.showNotification('You are outside the allowed attendance area!', 'error');
                        return;
                    }
                }
                
                const now = new Date();
                
                const attendanceRecord = {
                    id: Date.now(),
                    employeeId: parseInt(employeeId),
                    name: employee.name,
                    department: employee.department,
                    office: employee.office,
                    designation: employee.designation,
                    time: now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true }),
                    date: now.toISOString().split('T')[0],
                    status: 'present',
                    location: isEmployee ? 
                        document.getElementById('empLocationCoordinates').textContent : 
                        document.getElementById('locationCoordinates').textContent,
                    ip: isEmployee ? 
                        document.getElementById('empIpAddress').textContent : 
                        document.getElementById('ipAddress').textContent,
                    remarks: remarks,
                    photoTime: isEmployee ? 
                        document.getElementById('empPhotoCaptureTime').textContent : 
                        document.getElementById('photoCaptureTime').textContent,
                    method: remarks.includes('Manual') ? 'manual' : remarks.includes('Biometric') ? 'biometric' : 'camera'
                };
                
                this.attendanceRecords.unshift(attendanceRecord);
                this.saveData();
                
                if (isEmployee) {
                    document.getElementById('empAttendanceRemarks').value = '';
                    document.getElementById('empPhotoCaptureTime').textContent = 'Not captured';
                    document.getElementById('empMarkAttendanceBtn').disabled = true;
                    document.getElementById('empAlreadyMarked').style.display = 'block';
                    document.getElementById('empMarkedDetails').textContent = 
                        `Time: ${attendanceRecord.time} | Location: ${attendanceRecord.location}`;
                } else {
                    document.getElementById('attendanceEmployee').value = '';
                    document.getElementById('attendanceDepartment').value = '';
                    document.getElementById('attendanceDesignation').value = '';
                    document.getElementById('attendanceOffice').value = '';
                    document.getElementById('attendanceRemarks').value = '';
                    document.getElementById('photoCaptureTime').textContent = 'Not captured';
                    document.getElementById('markAttendanceBtn').disabled = true;
                }
                
                this.stopCamera(isEmployee);
                
                this.showNotification(`Attendance marked for ${employee.name}`, 'success');
                
                // Add notification
                this.addNotification({
                    title: 'Attendance Marked',
                    message: `${employee.name} marked attendance at ${attendanceRecord.time}`,
                    type: 'success',
                    read: false
                });
                
                if (isEmployee) {
                    this.loadEmployeeDashboard();
                    this.updateEmployeeNotificationCount();
                } else {
                    this.updateDashboard();
                    this.updateSidebarStats();
                    this.updateNotificationCount();
                }
            },
            
            loadEmployeesTable() {
                const tbody = document.getElementById('employeesTableBody');
                
                let html = '';
                this.employees.forEach(employee => {
                    html += `
                        <tr>
                            <td>${employee.id}</td>
                            <td>${employee.name}</td>
                            <td>${employee.department}</td>
                            <td>${employee.office}</td>
                            <td>${employee.designation}</td>
                            <td>${employee.loginId}</td>
                            <td>
                                <span class="status-badge ${employee.status === 'active' ? 'status-present' : 'status-absent'}">
                                    ${employee.status === 'active' ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-icon" style="background: #4caf50; color: white;" onclick="AppState.editEmployee(${employee.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-icon" style="background: #2196f3; color: white;" onclick="AppState.resetEmployeePassword(${employee.id})">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    <button class="btn btn-icon" style="background: #f44336; color: white;" onclick="AppState.deleteEmployee(${employee.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
                // Update employee counts
                const total = this.employees.length;
                const active = this.employees.filter(e => e.status === 'active').length;
                const inactive = total - active;
                
                document.getElementById('totalEmployeesCount').textContent = total;
                document.getElementById('activeEmployeesCount').textContent = active;
                document.getElementById('inactiveEmployeesCount').textContent = inactive;
            },
            
            showEmployeeModal(employee = null) {
                const modal = document.getElementById('employeeModal');
                const title = document.getElementById('modalTitle');
                
                if (employee) {
                    title.textContent = 'Edit Employee';
                    document.getElementById('employeeId').value = employee.id;
                    document.getElementById('empName').value = employee.name;
                    document.getElementById('empDepartment').value = employee.department;
                    document.getElementById('empOffice').value = employee.office;
                    document.getElementById('empDesignation').value = employee.designation;
                    document.getElementById('empContact').value = employee.contact;
                    document.getElementById('empEmail').value = employee.email || '';
                    document.getElementById('empJoiningDate').value = employee.joiningDate || '';
                    document.getElementById('empLoginId').value = employee.loginId || '';
                    document.getElementById('empPassword').value = employee.password || '';
                } else {
                    title.textContent = 'Add New Employee';
                    document.getElementById('employeeForm').reset();
                    document.getElementById('employeeId').value = '';
                    
                    const nextId = this.employees.length > 0 ? Math.max(...this.employees.map(e => e.id)) + 1 : 1;
                    const loginId = 'E' + nextId.toString().padStart(3, '0');
                    document.getElementById('empLoginId').value = loginId;
                    
                    // Set default joining date to today
                    document.getElementById('empJoiningDate').value = new Date().toISOString().split('T')[0];
                    
                    this.generatePassword();
                }
                
                modal.style.display = 'flex';
            },
            
            generatePassword() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let password = '';
                for (let i = 0; i < 8; i++) {
                    password += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                document.getElementById('empPassword').value = password;
            },
            
            closeEmployeeModal() {
                document.getElementById('employeeModal').style.display = 'none';
            },
            
            saveEmployee() {
                const id = document.getElementById('employeeId').value;
                const name = document.getElementById('empName').value.toUpperCase();
                const department = document.getElementById('empDepartment').value;
                const office = document.getElementById('empOffice').value;
                const designation = document.getElementById('empDesignation').value;
                const contact = document.getElementById('empContact').value;
                const email = document.getElementById('empEmail').value;
                const joiningDate = document.getElementById('empJoiningDate').value;
                const loginId = document.getElementById('empLoginId').value;
                const password = document.getElementById('empPassword').value;
                
                if (!name || !department || !office || !designation || !loginId || !password || !joiningDate) {
                    this.showNotification('Please fill all required fields', 'error');
                    return;
                }
                
                const employeeData = {
                    name,
                    department,
                    office,
                    designation,
                    contact,
                    email,
                    joiningDate,
                    loginId,
                    password,
                    status: 'active'
                };
                
                if (id) {
                    const index = this.employees.findIndex(emp => emp.id == id);
                    if (index !== -1) {
                        this.employees[index] = {
                            ...this.employees[index],
                            ...employeeData
                        };
                    }
                } else {
                    const newEmployee = {
                        id: this.employees.length > 0 ? 
                            Math.max(...this.employees.map(e => e.id)) + 1 : 1,
                        ...employeeData
                    };
                    this.employees.push(newEmployee);
                    
                    // Add notification for new employee
                    this.addNotification({
                        title: 'New Employee Added',
                        message: `${name} has been added to the system`,
                        type: 'info',
                        read: false
                    });
                }
                
                this.saveData();
                this.loadEmployees();
                this.loadEmployeesTable();
                this.updateDashboard();
                this.updateSidebarStats();
                this.closeEmployeeModal();
                
                this.showNotification(`Employee ${id ? 'updated' : 'added'} successfully`, 'success');
            },
            
            editEmployee(id) {
                const employee = this.employees.find(emp => emp.id == id);
                if (employee) {
                    this.showEmployeeModal(employee);
                }
            },
            
            resetEmployeePassword(id) {
                const employee = this.employees.find(emp => emp.id == id);
                if (employee) {
                    const newPassword = Math.random().toString(36).slice(-8);
                    employee.password = newPassword;
                    this.saveData();
                    
                    this.showNotification(`Password reset for ${employee.name}. New password: ${newPassword}`, 'success');
                }
            },
            
            deleteEmployee(id) {
                if (confirm('Are you sure you want to delete this employee?')) {
                    const employee = this.employees.find(emp => emp.id == id);
                    this.employees = this.employees.filter(emp => emp.id != id);
                    this.saveData();
                    this.loadEmployees();
                    this.loadEmployeesTable();
                    this.updateDashboard();
                    this.updateSidebarStats();
                    
                    // Add notification
                    if (employee) {
                        this.addNotification({
                            title: 'Employee Deleted',
                            message: `${employee.name} has been removed from the system`,
                            type: 'warning',
                            read: false
                        });
                    }
                    
                    this.showNotification('Employee deleted successfully', 'success');
                }
            },
            
            submitLeaveApplication() {
                const employeeId = this.currentUser.id;
                const employee = this.employees.find(emp => emp.id == employeeId);
                
                if (!employee) {
                    this.showNotification('Employee not found', 'error');
                    return;
                }
                
                const leaveType = document.getElementById('empLeaveType').value;
                const fromDate = document.getElementById('empLeaveFromDate').value;
                const toDate = document.getElementById('empLeaveToDate').value;
                const reason = document.getElementById('empLeaveReason').value;
                
                if (!leaveType || !fromDate || !toDate || !reason) {
                    this.showNotification('Please fill all required fields', 'error');
                    return;
                }
                
                const from = new Date(fromDate);
                const to = new Date(toDate);
                const diffTime = Math.abs(to - from);
                const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                
                const now = new Date();
                
                const leaveApplication = {
                    id: Date.now(),
                    employeeId: parseInt(employeeId),
                    employeeName: employee.name,
                    employeeDesignation: employee.designation,
                    employeeDepartment: employee.department,
                    leaveType: leaveType,
                    fromDate: fromDate,
                    toDate: toDate,
                    days: days,
                    reason: reason,
                    status: 'pending',
                    appliedOn: now.toISOString().split('T')[0],
                    appliedTime: now.toLocaleTimeString()
                };
                
                this.leaveApplications.unshift(leaveApplication);
                this.saveData();
                
                document.getElementById('empLeaveForm').reset();
                
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('empLeaveFromDate').value = tomorrow.toISOString().split('T')[0];
                document.getElementById('empLeaveToDate').value = tomorrow.toISOString().split('T')[0];
                document.getElementById('empLeaveDays').value = '1 day(s)';
                
                this.showNotification('Leave application submitted successfully', 'success');
                
                // Add notification for admin
                this.addNotification({
                    title: 'New Leave Application',
                    message: `${employee.name} has applied for ${leaveType} leave`,
                    type: 'info',
                    read: false
                });
                
                this.loadEmployeeDashboard();
                this.loadEmployeeLeaveStatus();
                this.updateEmployeeNotificationCount();
            },
            
            loadLeaveApplications() {
                this.loadPendingLeaves();
                this.loadApprovedLeaves();
                this.loadRejectedLeaves();
                this.loadAllLeaves();
            },
            
            loadPendingLeaves() {
                const tbody = document.getElementById('pendingLeavesTableBody');
                
                const pendingLeaves = this.leaveApplications.filter(leave => leave.status === 'pending');
                
                let html = '';
                pendingLeaves.forEach((leave, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${leave.employeeName}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 50)}${leave.reason.length > 50 ? '...' : ''}</td>
                            <td>${leave.appliedOn}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-icon" style="background: #4caf50; color: white;" onclick="AppState.showLeaveActionModal(${leave.id}, 'approve')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-icon" style="background: #f44336; color: white;" onclick="AppState.showLeaveActionModal(${leave.id}, 'reject')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
                document.getElementById('sidebarPendingLeaves').textContent = pendingLeaves.length;
                document.getElementById('pendingLeavesDash').textContent = pendingLeaves.length;
            },
            
            loadApprovedLeaves() {
                const tbody = document.getElementById('approvedLeavesTableBody');
                
                const approvedLeaves = this.leaveApplications.filter(leave => leave.status === 'approved');
                
                let html = '';
                approvedLeaves.forEach((leave, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${leave.employeeName}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 50)}${leave.reason.length > 50 ? '...' : ''}</td>
                            <td>${leave.approvedBy || 'Admin'}</td>
                            <td>${leave.approvedOn || ''}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            },
            
            loadRejectedLeaves() {
                const tbody = document.getElementById('rejectedLeavesTableBody');
                
                const rejectedLeaves = this.leaveApplications.filter(leave => leave.status === 'rejected');
                
                let html = '';
                rejectedLeaves.forEach((leave, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${leave.employeeName}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 50)}${leave.reason.length > 50 ? '...' : ''}</td>
                            <td>${leave.rejectedBy || 'Admin'}</td>
                            <td>${leave.rejectedOn || ''}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            },
            
            loadAllLeaves() {
                const tbody = document.getElementById('allLeavesTableBody');
                
                let html = '';
                this.leaveApplications.forEach((leave, index) => {
                    let statusBadge = '';
                    switch(leave.status) {
                        case 'pending':
                            statusBadge = '<span class="status-badge status-pending">Pending</span>';
                            break;
                        case 'approved':
                            statusBadge = '<span class="status-badge status-approved">Approved</span>';
                            break;
                        case 'rejected':
                            statusBadge = '<span class="status-badge status-rejected">Rejected</span>';
                            break;
                    }
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${leave.employeeName}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 50)}${leave.reason.length > 50 ? '...' : ''}</td>
                            <td>${statusBadge}</td>
                            <td>${leave.appliedOn}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            },
            
            showLeaveActionModal(leaveId, actionType) {
                const modal = document.getElementById('leaveActionModal');
                const leave = this.leaveApplications.find(l => l.id == leaveId);
                
                if (!leave) {
                    this.showNotification('Leave application not found', 'error');
                    return;
                }
                
                document.getElementById('leaveActionId').value = leaveId;
                document.getElementById('leaveActionType').value = actionType;
                document.getElementById('leaveEmployeeName').value = leave.employeeName;
                document.getElementById('leaveTypeDisplay').value = leave.leaveType;
                document.getElementById('leavePeriod').value = `${leave.fromDate} to ${leave.toDate}`;
                document.getElementById('leaveDaysDisplay').value = leave.days + ' day(s)';
                document.getElementById('leaveReasonDisplay').value = leave.reason;
                
                document.getElementById('rejectionReasonSection').style.display = 'none';
                document.getElementById('confirmApproveBtn').style.display = 'none';
                document.getElementById('confirmRejectBtn').style.display = 'none';
                
                if (actionType === 'approve') {
                    document.getElementById('leaveModalTitle').textContent = 'Approve Leave Application';
                    document.getElementById('confirmApproveBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('leaveModalTitle').textContent = 'Reject Leave Application';
                    document.getElementById('rejectionReasonSection').style.display = 'block';
                    document.getElementById('confirmRejectBtn').style.display = 'inline-block';
                }
                
                modal.style.display = 'flex';
            },
            
            closeLeaveActionModal() {
                document.getElementById('leaveActionModal').style.display = 'none';
                document.getElementById('rejectionReason').value = '';
            },
            
            approveLeaveApplication() {
                const leaveId = document.getElementById('leaveActionId').value;
                const leaveIndex = this.leaveApplications.findIndex(l => l.id == leaveId);
                
                if (leaveIndex === -1) {
                    this.showNotification('Leave application not found', 'error');
                    return;
                }
                
                this.leaveApplications[leaveIndex].status = 'approved';
                this.leaveApplications[leaveIndex].approvedBy = this.currentUser.name;
                this.leaveApplications[leaveIndex].approvedOn = new Date().toISOString().split('T')[0];
                
                this.saveData();
                this.closeLeaveActionModal();
                this.loadLeaveApplications();
                this.updateSidebarStats();
                
                // Add notification for employee
                const leave = this.leaveApplications[leaveIndex];
                this.addNotification({
                    title: 'Leave Approved',
                    message: `Your ${leave.leaveType} leave has been approved`,
                    type: 'success',
                    read: false,
                    employeeId: leave.employeeId
                });
                
                this.showNotification('Leave application approved successfully', 'success');
            },
            
            rejectLeaveApplication() {
                const leaveId = document.getElementById('leaveActionId').value;
                const rejectionReason = document.getElementById('rejectionReason').value;
                const leaveIndex = this.leaveApplications.findIndex(l => l.id == leaveId);
                
                if (leaveIndex === -1) {
                    this.showNotification('Leave application not found', 'error');
                    return;
                }
                
                if (!rejectionReason) {
                    this.showNotification('Please enter reason for rejection', 'error');
                    return;
                }
                
                this.leaveApplications[leaveIndex].status = 'rejected';
                this.leaveApplications[leaveIndex].rejectedBy = this.currentUser.name;
                this.leaveApplications[leaveIndex].rejectedOn = new Date().toISOString().split('T')[0];
                this.leaveApplications[leaveIndex].rejectionReason = rejectionReason;
                
                this.saveData();
                this.closeLeaveActionModal();
                this.loadLeaveApplications();
                this.updateSidebarStats();
                
                // Add notification for employee
                const leave = this.leaveApplications[leaveIndex];
                this.addNotification({
                    title: 'Leave Rejected',
                    message: `Your ${leave.leaveType} leave has been rejected: ${rejectionReason}`,
                    type: 'warning',
                    read: false,
                    employeeId: leave.employeeId
                });
                
                this.showNotification('Leave application rejected successfully', 'success');
            },
            
            loadEmployeeDashboard() {
                const employeeId = this.currentUser.id;
                const today = new Date().toISOString().split('T')[0];
                
                const todayAttendance = this.attendanceRecords.find(record => 
                    record.employeeId == employeeId && record.date === today);
                
                document.getElementById('empTodayStatus').textContent = todayAttendance ? 'Present' : 'Not Marked';
                
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                const monthAttendance = this.attendanceRecords.filter(record => {
                    if (record.employeeId != employeeId) return false;
                    
                    const recordDate = new Date(record.date);
                    return recordDate.getMonth() === currentMonth && 
                           recordDate.getFullYear() === currentYear &&
                           record.status === 'present';
                });
                
                const monthLeaves = this.leaveApplications.filter(leave => {
                    if (leave.employeeId != employeeId || leave.status !== 'approved') return false;
                    
                    const fromDate = new Date(leave.fromDate);
                    return fromDate.getMonth() === currentMonth && 
                           fromDate.getFullYear() === currentYear;
                });
                
                const totalLeavesDays = monthLeaves.reduce((sum, leave) => sum + leave.days, 0);
                
                const workingDays = 22;
                const presentDays = monthAttendance.length;
                const absentDays = workingDays - presentDays - totalLeavesDays;
                const attendancePercentage = ((presentDays / workingDays) * 100).toFixed(1);
                
                document.getElementById('empTotalPresent').textContent = presentDays;
                document.getElementById('empTotalAbsent').textContent = absentDays > 0 ? absentDays : 0;
                document.getElementById('empTotalLeaves').textContent = totalLeavesDays;
                document.getElementById('empAttendancePercentage').textContent = attendancePercentage + '%';
                
                document.getElementById('empMonthPresent').textContent = presentDays;
                document.getElementById('empLeavesTaken').textContent = totalLeavesDays;
            },
            
            loadEmployeeAttendanceHistory() {
                const employeeId = this.currentUser.id;
                const selectedMonth = document.getElementById('empFilterMonth').value;
                const selectedYear = parseInt(document.getElementById('empFilterYear').value) || new Date().getFullYear();
                
                let filteredRecords = this.attendanceRecords.filter(record => 
                    record.employeeId == employeeId);
                
                if (selectedMonth) {
                    filteredRecords = filteredRecords.filter(record => {
                        const recordDate = new Date(record.date);
                        return recordDate.getMonth() === parseInt(selectedMonth) && 
                               recordDate.getFullYear() === selectedYear;
                    });
                }
                
                const tbody = document.getElementById('empAttendanceTableBody');
                
                let html = '';
                filteredRecords.forEach((record, index) => {
                    const date = new Date(record.date);
                    const dayName = date.toLocaleDateString('en-IN', { weekday: 'short' });
                    
                    let statusBadge = '';
                    if (record.status === 'present') {
                        statusBadge = '<span class="status-badge status-present">Present</span>';
                    } else {
                        statusBadge = '<span class="status-badge status-absent">Absent</span>';
                    }
                    
                    html += `
                        <tr>
                            <td>${record.date}</td>
                            <td>${dayName}</td>
                            <td>${record.time}</td>
                            <td>${record.status === 'present' ? '5:00 PM' : 'N/A'}</td>
                            <td>${statusBadge}</td>
                            <td>${record.location}</td>
                            <td>${record.remarks || ''}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
                // Setup month dropdown
                const monthSelect = document.getElementById('empFilterMonth');
                if (monthSelect.options.length <= 1) {
                    const months = [
                        'January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'
                    ];
                    
                    months.forEach((month, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = month;
                        monthSelect.appendChild(option);
                    });
                    
                    monthSelect.value = new Date().getMonth();
                }
                
                // Update chart
                this.updateEmployeeAttendanceChart();
            },
            
            loadEmployeeLeaveStatus() {
                const employeeId = this.currentUser.id;
                
                const pendingLeaves = this.leaveApplications.filter(leave => 
                    leave.employeeId == employeeId && leave.status === 'pending');
                
                let pendingHtml = '';
                pendingLeaves.forEach((leave, index) => {
                    pendingHtml += `
                        <tr>
                            <td>${leave.appliedOn}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 30)}${leave.reason.length > 30 ? '...' : ''}</td>
                            <td><span class="leave-status leave-pending">Pending</span></td>
                        </tr>
                    `;
                });
                
                document.getElementById('empPendingLeavesTableBody').innerHTML = pendingHtml;
                
                const approvedLeaves = this.leaveApplications.filter(leave => 
                    leave.employeeId == employeeId && leave.status === 'approved');
                
                let approvedHtml = '';
                approvedLeaves.forEach((leave, index) => {
                    approvedHtml += `
                        <tr>
                            <td>${leave.appliedOn}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 30)}${leave.reason.length > 30 ? '...' : ''}</td>
                            <td>${leave.approvedOn || ''}</td>
                        </tr>
                    `;
                });
                
                document.getElementById('empApprovedLeavesTableBody').innerHTML = approvedHtml;
                
                const rejectedLeaves = this.leaveApplications.filter(leave => 
                    leave.employeeId == employeeId && leave.status === 'rejected');
                
                let rejectedHtml = '';
                rejectedLeaves.forEach((leave, index) => {
                    rejectedHtml += `
                        <tr>
                            <td>${leave.appliedOn}</td>
                            <td>${leave.leaveType}</td>
                            <td>${leave.fromDate}</td>
                            <td>${leave.toDate}</td>
                            <td>${leave.days}</td>
                            <td>${leave.reason.substring(0, 30)}${leave.reason.length > 30 ? '...' : ''}</td>
                            <td>${leave.rejectedOn || ''}</td>
                        </tr>
                    `;
                });
                
                document.getElementById('empRejectedLeavesTableBody').innerHTML = rejectedHtml;
            },
            
            initEmployeeTraining() {
                // Update progress bars
                const systemProgress = this.trainingProgress.systemTraining || 0;
                const securityProgress = this.trainingProgress.securityTraining || 0;
                const productivityProgress = this.trainingProgress.productivityTraining || 0;
                
                document.getElementById('systemTrainingProgress').textContent = `Completion: ${systemProgress}%`;
                document.getElementById('systemTrainingBar').style.width = `${systemProgress}%`;
                
                document.getElementById('securityTrainingProgress').textContent = `Completion: ${securityProgress}%`;
                document.getElementById('securityTrainingBar').style.width = `${securityProgress}%`;
                
                document.getElementById('productivityTrainingProgress').textContent = `Completion: ${productivityProgress}%`;
                document.getElementById('productivityTrainingBar').style.width = `${productivityProgress}%`;
                
                // Update chart
                this.updateEmployeeTrainingChart();
            },
            
            startTraining(trainingType) {
                const trainingName = {
                    systemTraining: 'System Training',
                    securityTraining: 'Security Awareness',
                    productivityTraining: 'Productivity Training'
                }[trainingType];
                
                // Show training modal
                document.getElementById('trainingModal').style.display = 'flex';
                document.getElementById('trainingModalTitle').textContent = trainingName;
                
                // Load training content
                const trainingSteps = [
                    { title: 'Introduction', content: `Welcome to ${trainingName}! This module will guide you through the key concepts.` },
                    { title: 'Getting Started', content: 'Learn the basics and understand the importance of this training.' },
                    { title: 'Core Concepts', content: 'Dive deeper into the main topics and practical applications.' },
                    { title: 'Best Practices', content: 'Learn the recommended approaches and techniques.' },
                    { title: 'Assessment', content: 'Test your knowledge with a quick quiz.' }
                ];
                
                let stepsHtml = '';
                trainingSteps.forEach((step, index) => {
                    stepsHtml += `
                        <div class="training-step" data-step="${index}" style="display: ${index === 0 ? 'block' : 'none'}; margin-bottom: 20px;">
                            <h4>${step.title}</h4>
                            <p>${step.content}</p>
                        </div>
                    `;
                });
                
                document.getElementById('trainingSteps').innerHTML = stepsHtml;
                
                // Setup navigation
                let currentStep = 0;
                const totalSteps = trainingSteps.length;
                
                document.getElementById('prevTrainingStep').style.display = 'none';
                
                document.getElementById('nextTrainingStep').onclick = () => {
                    if (currentStep < totalSteps - 1) {
                        currentStep++;
                        document.querySelectorAll('.training-step').forEach((step, idx) => {
                            step.style.display = idx === currentStep ? 'block' : 'none';
                        });
                        
                        document.getElementById('prevTrainingStep').style.display = 'inline-block';
                        
                        if (currentStep === totalSteps - 1) {
                            document.getElementById('nextTrainingStep').innerHTML = 'Complete <i class="fas fa-check"></i>';
                        }
                    } else {
                        // Complete training
                        this.completeTraining(trainingType);
                        document.getElementById('trainingModal').style.display = 'none';
                    }
                };
                
                document.getElementById('prevTrainingStep').onclick = () => {
                    if (currentStep > 0) {
                        currentStep--;
                        document.querySelectorAll('.training-step').forEach((step, idx) => {
                            step.style.display = idx === currentStep ? 'block' : 'none';
                        });
                        
                        if (currentStep === 0) {
                            document.getElementById('prevTrainingStep').style.display = 'none';
                        }
                        
                        document.getElementById('nextTrainingStep').innerHTML = 'Next <i class="fas fa-arrow-right"></i>';
                    }
                };
            },
            
            completeTraining(trainingType) {
                // Update progress
                if (!this.trainingProgress[trainingType]) {
                    this.trainingProgress[trainingType] = 0;
                }
                
                this.trainingProgress[trainingType] = Math.min(100, this.trainingProgress[trainingType] + 20);
                this.saveData();
                
                this.showNotification('Training progress updated!', 'success');
                this.initEmployeeTraining();
                
                // Add notification
                this.addNotification({
                    title: 'Training Completed',
                    message: `You've made progress in ${trainingType.replace('Training', '')} training`,
                    type: 'success',
                    read: false,
                    employeeId: this.currentUser.id
                });
            },
            
            initEmployeeProfile() {
                const employee = this.employees.find(emp => emp.id == this.currentUser.id);
                if (employee) {
                    document.getElementById('empProfileId').value = employee.loginId;
                    document.getElementById('empProfileName').value = employee.name;
                    document.getElementById('empProfileDesignation').value = employee.designation;
                    document.getElementById('empProfileDepartment').value = employee.department;
                    document.getElementById('empProfileOffice').value = employee.office;
                    document.getElementById('empProfileEmail').value = employee.email;
                    document.getElementById('empProfileContact').value = employee.contact;
                    document.getElementById('empProfileJoiningDate').value = employee.joiningDate;
                }
            },
            
            changeEmployeePassword() {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                const employee = this.employees.find(emp => emp.id == this.currentUser.id);
                
                if (!employee) {
                    this.showNotification('Employee not found', 'error');
                    return;
                }
                
                if (employee.password !== currentPassword) {
                    this.showNotification('Current password is incorrect', 'error');
                    return;
                }
                
                if (newPassword.length < 6) {
                    this.showNotification('New password must be at least 6 characters', 'error');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    this.showNotification('New passwords do not match', 'error');
                    return;
                }
                
                employee.password = newPassword;
                this.saveData();
                
                document.getElementById('empPasswordForm').reset();
                
                this.showNotification('Password changed successfully', 'success');
                
                // Add notification
                this.addNotification({
                    title: 'Password Changed',
                    message: 'Your password has been updated successfully',
                    type: 'info',
                    read: false,
                    employeeId: this.currentUser.id
                });
            },
            
            saveEmployeeNotificationSettings() {
                const emailNotifications = document.getElementById('empEmailNotifications').checked;
                const smsNotifications = document.getElementById('empSMSNotifications').checked;
                const pushNotifications = document.getElementById('empPushNotifications').checked;
                
                // Save settings to localStorage
                const settings = {
                    emailNotifications,
                    smsNotifications,
                    pushNotifications
                };
                
                localStorage.setItem('emp_notification_settings', JSON.stringify(settings));
                
                this.showNotification('Notification preferences saved', 'success');
            },
            
            loadRecords() {
                const tbody = document.getElementById('recordsTableBody');
                
                let html = '';
                this.attendanceRecords.forEach((record, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${record.name}</td>
                            <td>${record.department}</td>
                            <td>${record.office}</td>
                            <td>${record.time}</td>
                            <td>
                                <span class="status-badge ${record.status === 'present' ? 'status-present' : 'status-absent'}">
                                    ${record.status === 'present' ? 'Present' : 'Absent'}
                                </span>
                            </td>
                            <td>${record.location}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-icon" style="background: #2196f3; color: white;" onclick="AppState.viewRecordDetails(${record.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-icon" style="background: #f44336; color: white;" onclick="AppState.deleteRecord(${record.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            },
            
            filterRecords() {
                const date = document.getElementById('filterDate').value;
                const employeeId = document.getElementById('filterEmployee').value;
                const status = document.getElementById('filterStatus').value;
                
                let filteredRecords = this.attendanceRecords;
                
                if (date) {
                    filteredRecords = filteredRecords.filter(record => record.date === date);
                }
                
                if (employeeId) {
                    filteredRecords = filteredRecords.filter(record => record.employeeId == employeeId);
                }
                
                if (status) {
                    filteredRecords = filteredRecords.filter(record => record.status === status);
                }
                
                const tbody = document.getElementById('recordsTableBody');
                
                let html = '';
                filteredRecords.forEach((record, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${record.name}</td>
                            <td>${record.department}</td>
                            <td>${record.office}</td>
                            <td>${record.time}</td>
                            <td>
                                <span class="status-badge ${record.status === 'present' ? 'status-present' : 'status-absent'}">
                                    ${record.status === 'present' ? 'Present' : 'Absent'}
                                </span>
                            </td>
                            <td>${record.location}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-icon" style="background: #2196f3; color: white;" onclick="AppState.viewRecordDetails(${record.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-icon" style="background: #f44336; color: white;" onclick="AppState.deleteRecord(${record.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            },
            
            resetFilters() {
                document.getElementById('filterDate').value = '';
                document.getElementById('filterEmployee').value = '';
                document.getElementById('filterStatus').value = '';
                this.loadRecords();
            },
            
            viewRecordDetails(recordId) {
                const record = this.attendanceRecords.find(r => r.id === recordId);
                if (!record) return;
                
                alert(`Record Details:\n\nName: ${record.name}\nDepartment: ${record.department}\nOffice: ${record.office}\nDesignation: ${record.designation}\nTime: ${record.time}\nDate: ${record.date}\nStatus: ${record.status}\nLocation: ${record.location}\nIP Address: ${record.ip}\nRemarks: ${record.remarks || 'None'}\nMethod: ${record.method || 'camera'}`);
            },
            
            deleteRecord(recordId) {
                if (confirm('Are you sure you want to delete this attendance record?')) {
                    this.attendanceRecords = this.attendanceRecords.filter(r => r.id !== recordId);
                    this.saveData();
                    this.loadRecords();
                    this.updateDashboard();
                    this.updateSidebarStats();
                    
                    this.showNotification('Attendance record deleted successfully', 'success');
                }
            },
            
            exportRecords() {
                const today = new Date().toISOString().split('T')[0];
                const filename = `attendance_records_${today}.csv`;
                
                let csv = 'S.No,Employee Name,Department,Office Name,Designation,Time,Date,Status,Location,IP Address,Remarks\n';
                
                this.attendanceRecords.forEach((record, index) => {
                    csv += `${index + 1},"${record.name}","${record.department}","${record.office}","${record.designation}","${record.time}","${record.date}","${record.status}","${record.location}","${record.ip}","${record.remarks || ''}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                this.showNotification('Records exported successfully as CSV', 'success');
            },
            
            exportPDF() {
                this.showNotification('PDF export feature coming soon!', 'info');
            },
            
            generateReport(type) {
                let reportData = '';
                let filename = '';
                
                const today = new Date().toISOString().split('T')[0];
                const currentMonth = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
                
                switch(type) {
                    case 'daily':
                        filename = `daily_report_${today}.csv`;
                        const todayRecords = this.attendanceRecords.filter(r => r.date === today);
                        
                        reportData = 'S.No,Employee Name,Department,Office Name,Designation,Time,Status,Location,Remarks\n';
                        todayRecords.forEach((record, index) => {
                            reportData += `${index + 1},"${record.name}","${record.department}","${record.office}","${record.designation}","${record.time}","${record.status}","${record.location}","${record.remarks || ''}"\n`;
                        });
                        
                        if (todayRecords.length === 0) {
                            this.showNotification('No attendance records for today', 'info');
                            return;
                        }
                        break;
                        
                    case 'monthly':
                        filename = `monthly_report_${currentMonth.replace(' ', '_')}.csv`;
                        
                        const recordsByDate = {};
                        this.attendanceRecords.forEach(record => {
                            if (!recordsByDate[record.date]) {
                                recordsByDate[record.date] = [];
                            }
                            recordsByDate[record.date].push(record);
                        });
                        
                        reportData = 'Date,Present Count,Absent Count,Total Employees,Attendance Percentage\n';
                        
                        for (const date in recordsByDate) {
                            const dateRecords = recordsByDate[date];
                            const presentCount = dateRecords.filter(r => r.status === 'present').length;
                            const absentCount = this.employees.length - presentCount;
                            const attendancePercentage = (presentCount / this.employees.length * 100).toFixed(2);
                            
                            reportData += `${date},${presentCount},${absentCount},${this.employees.length},${attendancePercentage}%\n`;
                        }
                        break;
                        
                    case 'department':
                        filename = `department_report_${today}.csv`;
                        
                        const deptStats = {};
                        this.employees.forEach(emp => {
                            if (!deptStats[emp.department]) {
                                deptStats[emp.department] = { total: 0, present: 0 };
                            }
                            deptStats[emp.department].total++;
                        });
                        
                        const todayAttendance = this.attendanceRecords.filter(r => r.date === today);
                        todayAttendance.forEach(record => {
                            if (record.status === 'present' && deptStats[record.department]) {
                                deptStats[record.department].present++;
                            }
                        });
                        
                        reportData = 'Department,Total Employees,Present Today,Absent Today,Attendance Percentage\n';
                        
                        for (const dept in deptStats) {
                            const stats = deptStats[dept];
                            const absent = stats.total - stats.present;
                            const percentage = (stats.present / stats.total * 100).toFixed(2);
                            
                            reportData += `"${dept}",${stats.total},${stats.present},${absent},${percentage}%\n`;
                        }
                        break;
                        
                    case 'leave':
                        filename = `leave_report_${currentMonth.replace(' ', '_')}.csv`;
                        
                        reportData = 'Employee Name,Designation,Department,Leave Type,From Date,To Date,Days,Reason,Status\n';
                        
                        this.leaveApplications.forEach(leave => {
                            reportData += `"${leave.employeeName}","${leave.employeeDesignation}","${leave.employeeDepartment}","${leave.leaveType}","${leave.fromDate}","${leave.toDate}","${leave.days}","${leave.reason}","${leave.status}"\n`;
                        });
                        break;
                }
                
                const blob = new Blob([reportData], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                this.showNotification(`${type} report generated successfully`, 'success');
            },
            
            saveSettings() {
                const settings = {
                    enableGeofence: document.getElementById('enableGeofence').checked,
                    enableNotifications: document.getElementById('enableNotifications').checked,
                    enableCamera: document.getElementById('enableCamera').checked,
                    enableGPS: document.getElementById('enableGPS').checked,
                    startTime: document.getElementById('startTime').value,
                    endTime: document.getElementById('endTime').value,
                    language: document.getElementById('systemLanguage').value
                };
                
                this.geofenceEnabled = settings.enableGeofence;
                
                try {
                    localStorage.setItem('panchayat_settings', JSON.stringify(settings));
                    this.showNotification('Settings saved successfully', 'success');
                } catch (error) {
                    this.showNotification('Error saving settings', 'error');
                }
            },
            
            resetSettings() {
                if (confirm('Reset all settings to default?')) {
                    document.getElementById('enableGeofence').checked = true;
                    document.getElementById('enableNotifications').checked = true;
                    document.getElementById('enableCamera').checked = true;
                    document.getElementById('enableGPS').checked = true;
                    document.getElementById('startTime').value = '09:00';
                    document.getElementById('endTime').value = '17:00';
                    document.getElementById('systemLanguage').value = 'hi';
                    
                    this.geofenceEnabled = true;
                    
                    this.showNotification('Settings reset to default', 'success');
                }
            },
            
            backupData() {
                const data = {
                    employees: this.employees,
                    attendance: this.attendanceRecords,
                    leaves: this.leaveApplications,
                    settings: JSON.parse(localStorage.getItem('panchayat_settings') || '{}'),
                    notifications: this.notifications,
                    training: this.trainingProgress
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `attendance_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                this.showNotification('Data backed up successfully', 'success');
            },
            
            restoreData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (confirm('Restore data? This will replace all current data.')) {
                                this.employees = data.employees || [];
                                this.attendanceRecords = data.attendance || [];
                                this.leaveApplications = data.leaves || [];
                                this.notifications = data.notifications || [];
                                this.trainingProgress = data.training || {};
                                
                                if (data.settings) {
                                    localStorage.setItem('panchayat_settings', JSON.stringify(data.settings));
                                }
                                
                                this.saveData();
                                this.showNotification('Data restored successfully', 'success');
                                
                                // Refresh the page
                                location.reload();
                            }
                        } catch (error) {
                            this.showNotification('Error restoring data', 'error');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            },
            
            clearData() {
                if (confirm('WARNING: This will delete ALL data. Are you sure?')) {
                    if (confirm('This action cannot be undone. Type "DELETE" to confirm.')) {
                        const confirmation = prompt('Type DELETE to confirm:');
                        if (confirmation === 'DELETE') {
                            localStorage.clear();
                            this.showNotification('All data cleared successfully', 'success');
                            location.reload();
                        }
                    }
                }
            },
            
            importEmployees() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.csv';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        try {
                            const csvData = event.target.result;
                            const lines = csvData.split('\n');
                            const headers = lines[0].split(',');
                            
                            let imported = 0;
                            for (let i = 1; i < lines.length; i++) {
                                if (lines[i].trim()) {
                                    const values = lines[i].split(',');
                                    const employee = {
                                        id: this.employees.length + 1,
                                        name: values[0] || '',
                                        department: values[1] || '  ',
                                        office: values[2] || '  ',
                                        designation: values[3] || 'DATA ENTRY OPERATOR',
                                        contact: values[4] || '',
                                        email: values[5] || '',
                                        loginId: `E${(this.employees.length + 1).toString().padStart(3, '0')}`,
                                        password: 'password123',
                                        status: 'active',
                                        joiningDate: new Date().toISOString().split('T')[0]
                                    };
                                    
                                    this.employees.push(employee);
                                    imported++;
                                }
                            }
                            
                            this.saveData();
                            this.loadEmployees();
                            this.loadEmployeesTable();
                            this.updateDashboard();
                            this.updateSidebarStats();
                            
                            this.showNotification(`Imported ${imported} employees successfully`, 'success');
                        } catch (error) {
                            this.showNotification('Error importing CSV file', 'error');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            },
            
            updateDashboard() {
                const today = new Date().toISOString().split('T')[0];
                const todayRecords = this.attendanceRecords.filter(r => r.date === today);
                const presentToday = todayRecords.filter(r => r.status === 'present').length;
                const pendingLeaves = this.leaveApplications.filter(l => l.status === 'pending').length;
                
                document.getElementById('todayPresent').textContent = presentToday;
                document.getElementById('todayAbsent').textContent = this.employees.length - presentToday;
                document.getElementById('totalEmployeesDash').textContent = this.employees.length;
                document.getElementById('pendingLeavesDash').textContent = pendingLeaves;
                
                // Calculate additional metrics
                const avgAttendance = ((presentToday / this.employees.length) * 100).toFixed(1);
                const lateComers = todayRecords.filter(r => {
                    const time = r.time;
                    const hour = parseInt(time.split(':')[0]);
                    const isAM = time.includes('AM');
                    return (isAM && hour >= 9 && hour < 12) || (!isAM && hour < 9);
                }).length;
                
                document.getElementById('avgAttendance').textContent = `${avgAttendance}%`;
                document.getElementById('lateComers').textContent = lateComers;
                document.getElementById('earlyLeavers').textContent = 1; // Sample data
                document.getElementById('overtimeHours').textContent = 12; // Sample data
            },
            
            updateSidebarStats() {
                const today = new Date().toISOString().split('T')[0];
                const todayRecords = this.attendanceRecords.filter(r => r.date === today);
                const presentToday = todayRecords.filter(r => r.status === 'present').length;
                const pendingLeaves = this.leaveApplications.filter(l => l.status === 'pending').length;
                
                document.getElementById('sidebarAttendanceCount').textContent = todayRecords.length;
                document.getElementById('sidebarEmployeeCount').textContent = this.employees.length;
                document.getElementById('sidebarPresentCount').textContent = presentToday;
                document.getElementById('sidebarPendingLeaves').textContent = pendingLeaves;
            },
            
            addNotification(notification) {
                notification.id = Date.now();
                notification.time = 'Just now';
                notification.read = notification.read || false;
                
                this.notifications.unshift(notification);
                this.saveData();
                
                // Update notification counts
                this.updateNotificationCount();
                this.updateEmployeeNotificationCount();
            },
            
            updateNotificationCount() {
                const unreadCount = this.notifications.filter(n => !n.read).length;
                const countElement = document.getElementById('notificationCount');
                
                if (unreadCount > 0) {
                    countElement.textContent = unreadCount;
                    countElement.style.display = 'flex';
                } else {
                    countElement.style.display = 'none';
                }
            },
            
            updateEmployeeNotificationCount() {
                if (!this.currentUser || this.currentUserType !== 'employee') return;
                
                const employeeNotifications = this.notifications.filter(n => 
                    (!n.employeeId || n.employeeId === this.currentUser.id) && !n.read
                );
                
                const countElement = document.getElementById('empNotificationCount');
                
                if (employeeNotifications.length > 0) {
                    countElement.textContent = employeeNotifications.length;
                    countElement.style.display = 'flex';
                } else {
                    countElement.style.display = 'none';
                }
            },
            
            loadNotifications() {
                const notificationsList = document.getElementById('notificationsList');
                const unreadList = document.getElementById('unreadNotificationsList');
                const systemList = document.getElementById('systemNotificationsList');
                const alertList = document.getElementById('alertNotificationsList');
                
                // Clear lists
                [notificationsList, unreadList, systemList, alertList].forEach(list => {
                    if (list) list.innerHTML = '';
                });
                
                let allHtml = '';
                let unreadHtml = '';
                let systemHtml = '';
                let alertHtml = '';
                
                this.notifications.forEach(notification => {
                    const notificationHtml = `
                        <div class="notification-item ${notification.read ? '' : 'unread'}" data-id="${notification.id}">
                            <h4 style="margin-bottom: 5px;">${notification.title}</h4>
                            <p style="color: var(--gray); font-size: 14px; margin-bottom: 5px;">${notification.message}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px; color: var(--gray);">${notification.time}</span>
                                ${!notification.read ? '<span class="status-badge status-pending" style="font-size: 10px;">New</span>' : ''}
                            </div>
                        </div>
                    `;
                    
                    allHtml += notificationHtml;
                    
                    if (!notification.read) {
                        unreadHtml += notificationHtml;
                    }
                    
                    if (notification.type === 'system') {
                        systemHtml += notificationHtml;
                    }
                    
                    if (notification.type === 'warning' || notification.type === 'error') {
                        alertHtml += notificationHtml;
                    }
                });
                
                if (notificationsList) notificationsList.innerHTML = allHtml || '<p style="text-align: center; color: var(--gray);">No notifications</p>';
                if (unreadList) unreadList.innerHTML = unreadHtml || '<p style="text-align: center; color: var(--gray);">No unread notifications</p>';
                if (systemList) systemList.innerHTML = systemHtml || '<p style="text-align: center; color: var(--gray);">No system notifications</p>';
                if (alertList) alertList.innerHTML = alertHtml || '<p style="text-align: center; color: var(--gray);">No alert notifications</p>';
                
                // Add click handlers to mark as read
                document.querySelectorAll('.notification-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const id = parseInt(item.dataset.id);
                        const notification = this.notifications.find(n => n.id === id);
                        if (notification && !notification.read) {
                            notification.read = true;
                            this.saveData();
                            this.updateNotificationCount();
                            item.classList.remove('unread');
                        }
                    });
                });
            },
            
            markAllNotificationsRead() {
                this.notifications.forEach(notification => {
                    notification.read = true;
                });
                this.saveData();
                this.updateNotificationCount();
                this.loadNotifications();
                this.showNotification('All notifications marked as read', 'success');
            },
            
            showNotificationDropdown() {
                // For now, just show notifications section
                this.showSection('notifications', 'admin');
            },
            
            initAnalytics() {
                this.setupCharts();
            },
            
            setupCharts() {
                // Attendance Trend Chart
                const trendCtx = document.getElementById('attendanceTrendChart');
                if (trendCtx) {
                    this.charts.attendanceTrend = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                            datasets: [{
                                label: 'Attendance %',
                                data: [85, 88, 92, 90, 87, 45],
                                borderColor: '#1a237e',
                                backgroundColor: 'rgba(26, 35, 126, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                }
                            }
                        }
                    });
                }
                
                // Department Distribution Chart
                const deptCtx = document.getElementById('departmentChart');
                if (deptCtx) {
                    this.charts.department = new Chart(deptCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Panchayati Raj', 'Administration', 'Finance', 'Others'],
                            datasets: [{
                                data: [65, 15, 10, 10],
                                backgroundColor: [
                                    '#1a237e',
                                    '#534bae',
                                    '#00695c',
                                    '#ff6f00'
                                ]
                            }]
                        }
                    });
                }
                
                // Performance Chart
                const performanceCtx = document.getElementById('performanceChart');
                if (performanceCtx) {
                    this.charts.performance = new Chart(performanceCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Efficiency', 'Punctuality', 'Productivity', 'Teamwork'],
                            datasets: [{
                                label: 'Score',
                                data: [85, 92, 78, 88],
                                backgroundColor: [
                                    'rgba(26, 35, 126, 0.8)',
                                    'rgba(83, 75, 174, 0.8)',
                                    'rgba(0, 105, 92, 0.8)',
                                    'rgba(255, 111, 0, 0.8)'
                                ]
                            }]
                        }
                    });
                }
            },
            
            updateEmployeeAttendanceChart() {
                const ctx = document.getElementById('empAttendanceChart');
                if (ctx) {
                    // Sample data for employee attendance chart
                    const employeeId = this.currentUser.id;
                    const last7Days = Array.from({length: 7}, (_, i) => {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        return d.toISOString().split('T')[0];
                    }).reverse();
                    
                    const attendanceData = last7Days.map(date => {
                        const record = this.attendanceRecords.find(r => 
                            r.employeeId == employeeId && r.date === date);
                        return record ? 1 : 0;
                    });
                    
                    if (this.charts.empAttendance) {
                        this.charts.empAttendance.destroy();
                    }
                    
                    this.charts.empAttendance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: last7Days.map(d => new Date(d).toLocaleDateString('en-IN', { weekday: 'short' })),
                            datasets: [{
                                label: 'Attendance',
                                data: attendanceData,
                                borderColor: '#1a237e',
                                backgroundColor: 'rgba(26, 35, 126, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    min: 0,
                                    max: 1,
                                    ticks: {
                                        callback: function(value) {
                                            return value === 1 ? 'Present' : 'Absent';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            },
            
            updateEmployeeTrainingChart() {
                const ctx = document.getElementById('empTrainingChart');
                if (ctx) {
                    if (this.charts.empTraining) {
                        this.charts.empTraining.destroy();
                    }
                    
                    this.charts.empTraining = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['System', 'Security', 'Productivity'],
                            datasets: [{
                                label: 'Progress %',
                                data: [
                                    this.trainingProgress.systemTraining || 0,
                                    this.trainingProgress.securityTraining || 0,
                                    this.trainingProgress.productivityTraining || 0
                                ],
                                backgroundColor: [
                                    'rgba(26, 35, 126, 0.8)',
                                    'rgba(83, 75, 174, 0.8)',
                                    'rgba(0, 105, 92, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                }
            },
            
            initTraining() {
                // Update training progress chart
                const ctx = document.getElementById('trainingProgressChart');
                if (ctx) {
                    if (this.charts.trainingProgress) {
                        this.charts.trainingProgress.destroy();
                    }
                    
                    // Calculate overall training progress
                    const totalProgress = Object.values(this.trainingProgress).reduce((a, b) => a + b, 0);
                    const avgProgress = Object.keys(this.trainingProgress).length > 0 ? 
                        totalProgress / Object.keys(this.trainingProgress).length : 0;
                    
                    this.charts.trainingProgress = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: ['System', 'Security', 'Productivity'],
                            datasets: [{
                                label: 'Training Progress',
                                data: [
                                    this.trainingProgress.systemTraining || 0,
                                    this.trainingProgress.securityTraining || 0,
                                    this.trainingProgress.productivityTraining || 0
                                ],
                                backgroundColor: 'rgba(26, 35, 126, 0.2)',
                                borderColor: '#1a237e',
                                pointBackgroundColor: '#1a237e'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                }
            },
            
            initBiometric() {
                // Initialize biometric settings from localStorage
                const savedSettings = localStorage.getItem('biometric_settings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    document.getElementById('enableBiometric').checked = settings.enableBiometric !== false;
                    document.getElementById('enableMultiFactor').checked = settings.enableMultiFactor !== false;
                    document.getElementById('enableFallback').checked = settings.enableFallback !== false;
                }
            },
            
            saveBiometricSettings() {
                const settings = {
                    enableBiometric: document.getElementById('enableBiometric').checked,
                    enableMultiFactor: document.getElementById('enableMultiFactor').checked,
                    enableFallback: document.getElementById('enableFallback').checked
                };
                
                localStorage.setItem('biometric_settings', JSON.stringify(settings));
                this.showNotification('Biometric settings saved', 'success');
            },
            
            showNotification(message, type = 'info') {
                const existingNotifications = document.querySelectorAll('.notification');
                existingNotifications.forEach(n => n.remove());
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            },
            
            hideLoading() {
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                    }, 500);
                }, 1000);
            },
            
            initGeofenceSection() {
                document.getElementById('geofenceLat').value = this.geofence.lat;
                document.getElementById('geofenceLng').value = this.geofence.lng;
                document.getElementById('geofenceRadius').value = this.geofence.radius;
                
                this.initMap();
            },
            
            initMap() {
                if (this.map) {
                    this.map.remove();
                }
                
                this.map = L.map('geofenceMap').setView([this.geofence.lat, this.geofence.lng], 16);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors'
                }).addTo(this.map);
                
                this.updateGeofenceMap();
            },
            
            updateGeofenceMap() {
                if (!this.map) return;
                
                const lat = parseFloat(document.getElementById('geofenceLat').value) || this.geofence.lat;
                const lng = parseFloat(document.getElementById('geofenceLng').value) || this.geofence.lng;
                const radius = parseInt(document.getElementById('geofenceRadius').value) || this.geofence.radius;
                
                this.map.setView([lat, lng], 16);
                
                this.map.eachLayer((layer) => {
                    if (layer instanceof L.Circle) {
                        this.map.removeLayer(layer);
                    }
                });
                
                L.circle([lat, lng], {
                    color: '#1a237e',
                    fillColor: '#1a237e',
                    fillOpacity: 0.1,
                    radius: radius
                }).addTo(this.map);
                
                L.marker([lat, lng]).addTo(this.map)
                    .bindPopup('Geofence Center<br>Radius: ' + radius + ' meters')
                    .openPopup();
            },
            
            saveGeofence() {
                const lat = parseFloat(document.getElementById('geofenceLat').value);
                const lng = parseFloat(document.getElementById('geofenceLng').value);
                const radius = parseInt(document.getElementById('geofenceRadius').value);
                
                if (!lat || !lng || !radius) {
                    this.showNotification('Please fill all geofence fields', 'error');
                    return;
                }
                
                this.geofence = {
                    lat: lat,
                    lng: lng,
                    radius: radius
                };
                
                this.saveData();
                this.updateGeofenceMap();
                
                this.showNotification('Geofence settings saved successfully', 'success');
            }
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            AppState.init();
        });

        // Make AppState available globally for onclick handlers
        window.AppState = AppState;
    </script>
</body>
</html>
